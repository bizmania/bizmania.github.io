// ==UserScript==
// @name bm-userscript
// @version 7.2.0
// @namespace https://github.com/bizmania
// @description Visual improvements for bizmania.ru
// @author bizmania
// @homepage https://github.com/bizmania/bm-userscript#readme
// @updateURL https://bizmania.github.io/plugin/bm-userscript.meta.js
// @downloadURL https://bizmania.github.io/plugin/bm-userscript.user.js
// @license https://opensource.org/licenses/MIT
// @match https://bizmania.ru/*
// @require https://cdn.jsdelivr.net/npm/@trim21/gm-fetch@0.1.15
// @require https://cdn.jsdelivr.net/npm/axios@1.6.8
// @connect bizmania.github.io
// @connect bizmania.ru
// @grant GM.xmlHttpRequest
// ==/UserScript==

(()=>{"use strict";var __webpack_modules__={821:function(__unused_webpack_module,exports,__webpack_require__){var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:true});const pages_1=__webpack_require__(826);const getMyCompany_1=__webpack_require__(591);const mainMenu_1=__webpack_require__(793);(function(){return __awaiter(this,void 0,void 0,(function*(){const dlh=document.location.host;const dlp=document.location.pathname;const sp=new URLSearchParams(document.location.search);if(dlh!=="bizmania.ru"){return}if(dlp.startsWith("/user/messages")){return}const{companyId}=yield(0,getMyCompany_1.getMyCompany)();if(!!companyId){(0,mainMenu_1.upgradeMainMenu)(companyId)}switch(true){case dlp.startsWith("/user/gameshop"):{switch(sp.get("tab")){case"weeklypacks":{(0,pages_1.onWeeklyPacksPage)();break}}break}case dlp.startsWith("/units/vendor/select"):{(0,pages_1.onVendorSelectPage)();break}case dlp.startsWith("/units/factory"):{(0,pages_1.onFactoryPage)();break}case dlp.startsWith("/units/mine"):{(0,pages_1.onMinePage)();break}case dlp.startsWith("/units/sawmill"):{(0,pages_1.onSawmillPage)();break}case dlp.startsWith("/units/fishfarm"):{(0,pages_1.onFishfarmPage)();break}case dlp.startsWith("/units/shop"):{(0,pages_1.onShopPage)();break}case dlp.startsWith("/units/produce/calculator"):{(0,pages_1.onCalculatorPage)();break}case dlp.startsWith("/units/construction"):{(0,pages_1.onConstructionPage)();break}case dlp.startsWith("/units/warehouse"):{(0,pages_1.onWarehousePage)();break}}}))})().catch(console.error)},964:function(__unused_webpack_module,exports,__webpack_require__){var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:true});exports.onCalculatorPage=void 0;const addDownloadButton_1=__webpack_require__(6);const addProductsFilter_1=__webpack_require__(420);const addProductsPane_1=__webpack_require__(52);const onCalculatorPage=()=>__awaiter(void 0,void 0,void 0,(function*(){(0,addProductsFilter_1.addProductsFilter)();(0,addProductsPane_1.addProductsPane)();(0,addDownloadButton_1.addDownloadButton)()}));exports.onCalculatorPage=onCalculatorPage},739:function(__unused_webpack_module,exports,__webpack_require__){var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){if(k2===undefined)k2=k;var desc=Object.getOwnPropertyDescriptor(m,k);if(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable)){desc={enumerable:true,get:function(){return m[k]}}}Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){if(k2===undefined)k2=k;o[k2]=m[k]});var __exportStar=this&&this.__exportStar||function(m,exports){for(var p in m)if(p!=="default"&&!Object.prototype.hasOwnProperty.call(exports,p))__createBinding(exports,m,p)};Object.defineProperty(exports,"__esModule",{value:true});__exportStar(__webpack_require__(964),exports)},6:function(__unused_webpack_module,exports,__webpack_require__){var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:true});exports.addDownloadButton=void 0;const addFontAwesome_1=__webpack_require__(478);const addDownloadButton=()=>__awaiter(void 0,void 0,void 0,(function*(){var _a,_b,_c;const linkHolderEl=document.querySelector("div.pad12 div.pad12 h3");const padH3Els=document.querySelectorAll("div.pad12 h3");const tableEl=document.querySelector(".datatable");const rowEls=(_a=tableEl===null||tableEl===void 0?void 0:tableEl.tBodies[0])===null||_a===void 0?void 0:_a.rows;if(!padH3Els.length||!rowEls||!linkHolderEl){return}const name=(_c=(_b=padH3Els[3])===null||_b===void 0?void 0:_b.innerText)!==null&&_c!==void 0?_c:"";const rows=[...rowEls].map((({cells})=>[name,cells[0].innerText,cells[1].innerText,parseFloat(cells[2].innerText),parseFloat(cells[4].innerText.replace(/\s+/g,""))]));const csvContent="data:text/csv;charset=utf-8,"+rows.map((e=>e.join(","))).join("\n")+"\n";const encodedUri=encodeURI(csvContent);const link=document.createElement("a");link.setAttribute("href",encodedUri);link.setAttribute("download",`prod.${name}.csv`);link.text=" [ Скачать данные ]";let i_elem=document.createElement("i");i_elem.classList.add("fa");i_elem.classList.add("fa-file-excel-o");i_elem.setAttribute("aria-hidden","true");link.appendChild(i_elem);linkHolderEl.appendChild(link);(0,addFontAwesome_1.addFontAwesome)()}));exports.addDownloadButton=addDownloadButton},420:function(__unused_webpack_module,exports){var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:true});exports.addProductsFilter=void 0;const addProductsFilter=()=>__awaiter(void 0,void 0,void 0,(function*(){var _a,_b;const productsIframeEl=document.querySelector("#product_frm");const frm=(_a=productsIframeEl===null||productsIframeEl===void 0?void 0:productsIframeEl.contentWindow)===null||_a===void 0?void 0:_a.document;if(!frm){return}const tableEl=frm.querySelector("table");const tableCells=[...frm.querySelectorAll("td")];const elI=document.createElement("input");elI.type="text";elI.placeholder="поиск ... ";elI.onkeyup=event=>{const value=event.target.value;tableCells.forEach((td=>{var _a;td.style.display=((_a=td.textContent)!==null&&_a!==void 0?_a:"").toLowerCase().includes(value.toLowerCase())?"":"none"}))};(_b=tableEl===null||tableEl===void 0?void 0:tableEl.parentElement)===null||_b===void 0?void 0:_b.insertBefore(elI,tableEl)}));exports.addProductsFilter=addProductsFilter},52:function(__unused_webpack_module,exports){var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:true});exports.addProductsPane=void 0;const addProductsPane=()=>__awaiter(void 0,void 0,void 0,(function*(){var _a;const selectEl=document.querySelector("#content > form > div:nth-child(1) > table > tbody > tr:nth-child(1) > td:nth-child(2) > select");const productsIframeEl=document.querySelector("#product_frm");const frm=(_a=productsIframeEl===null||productsIframeEl===void 0?void 0:productsIframeEl.contentWindow)===null||_a===void 0?void 0:_a.document;if(!selectEl||!frm){return}const cityId=selectEl.value;const imageEls=frm.querySelectorAll("td > img");const newLinkEls=[...imageEls].map((imageEl=>{var _a,_b,_c,_d,_e;const newLinkEl=document.createElement("a");const newImageEl=document.createElement("img");const nextCell=(_a=imageEl.parentNode)===null||_a===void 0?void 0:_a.nextSibling;const linkEl=nextCell===null||nextCell===void 0?void 0:nextCell.querySelector("a");const productId=(_d=(_c=(_b=linkEl===null||linkEl===void 0?void 0:linkEl.href)===null||_b===void 0?void 0:_b.match(/productComboSelect\(\"product\",(\d+),/))===null||_c===void 0?void 0:_c[1])!==null&&_d!==void 0?_d:"0";newLinkEl.title=(_e=linkEl===null||linkEl===void 0?void 0:linkEl.textContent)!==null&&_e!==void 0?_e:"";newLinkEl.href=`/units/produce/calculator/?product=${productId}&city=${cityId}`;newLinkEl.appendChild(newImageEl);newImageEl.src=imageEl.src;return newLinkEl}));const newCellEl=document.createElement("td");newCellEl.colSpan=6;const newRowEl=document.createElement("tr");newRowEl.appendChild(newCellEl);const tableBodyEl=document.querySelector("#content > form > div:nth-child(1) > table > tbody");tableBodyEl===null||tableBodyEl===void 0?void 0:tableBodyEl.appendChild(newRowEl);newLinkEls.forEach((el=>{newCellEl.appendChild(el);newCellEl.appendChild(document.createTextNode(" "))}))}));exports.addProductsPane=addProductsPane},426:function(__unused_webpack_module,exports,__webpack_require__){var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:true});exports.onConstructionPage=void 0;const hideEmptyRequired_1=__webpack_require__(566);const onConstructionPage=()=>__awaiter(void 0,void 0,void 0,(function*(){var _a;const sp=new URLSearchParams(document.location.search);const constructionId=Number(sp.get("id"));const productId=Number(sp.get("product"));const tab=(_a=sp.get("tab"))!==null&&_a!==void 0?_a:"unit";switch(tab){case"unit":{break}case"goods":{(0,hideEmptyRequired_1.hideEmptyRequirements)();break}}}));exports.onConstructionPage=onConstructionPage},574:function(__unused_webpack_module,exports,__webpack_require__){var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){if(k2===undefined)k2=k;var desc=Object.getOwnPropertyDescriptor(m,k);if(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable)){desc={enumerable:true,get:function(){return m[k]}}}Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){if(k2===undefined)k2=k;o[k2]=m[k]});var __exportStar=this&&this.__exportStar||function(m,exports){for(var p in m)if(p!=="default"&&!Object.prototype.hasOwnProperty.call(exports,p))__createBinding(exports,m,p)};Object.defineProperty(exports,"__esModule",{value:true});__exportStar(__webpack_require__(426),exports)},566:function(__unused_webpack_module,exports){var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:true});exports.hideEmptyRequirements=void 0;const hideEmptyRequirements=()=>__awaiter(void 0,void 0,void 0,(function*(){const cell2=document.querySelector("#content > div.pad12 > form > div:nth-child(1) > table:nth-child(1) > thead > tr:nth-child(1) > td:nth-child(2)");if(!cell2){return}let newLinkEl=document.createElement("a");newLinkEl.textContent=" [hide]";newLinkEl.style.color="#5165a4";newLinkEl.href="#";newLinkEl.id="hideZero";newLinkEl.addEventListener("click",(()=>{const hideEls=document.querySelectorAll("#supplytbl > tbody > tr > td:nth-child(5) > div > span > div");if(!hideEls.length){return false}[...hideEls].forEach((i=>{var _a,_b,_c,_d;const value=parseInt((_a=i===null||i===void 0?void 0:i.textContent)!==null&&_a!==void 0?_a:"0");const closeRowEl=i.closest("tr");const closeValue=parseInt((_d=(_c=(_b=closeRowEl===null||closeRowEl===void 0?void 0:closeRowEl.cells)===null||_b===void 0?void 0:_b[9])===null||_c===void 0?void 0:_c.textContent)!==null&&_d!==void 0?_d:"0");if((value===0||closeValue>=value)&&closeRowEl){closeRowEl.style.display="none"}}));return false}));cell2.appendChild(newLinkEl)}));exports.hideEmptyRequirements=hideEmptyRequirements},146:function(__unused_webpack_module,exports,__webpack_require__){var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:true});exports.onFactoryPage=void 0;const getQbase_1=__webpack_require__(892);const addOptPriceInfo_1=__webpack_require__(244);const onFactoryPage=()=>__awaiter(void 0,void 0,void 0,(function*(){var _a;const sp=new URLSearchParams(document.location.search);const factoryId=Number(sp.get("id"));const tab=(_a=sp.get("tab"))!==null&&_a!==void 0?_a:"factory";switch(tab){case"factory":{break}case"goods":{(0,addOptPriceInfo_1.addOptPriceInfo)();(0,getQbase_1.loadQBase)(factoryId);break}}}));exports.onFactoryPage=onFactoryPage},371:function(__unused_webpack_module,exports,__webpack_require__){var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){if(k2===undefined)k2=k;var desc=Object.getOwnPropertyDescriptor(m,k);if(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable)){desc={enumerable:true,get:function(){return m[k]}}}Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){if(k2===undefined)k2=k;o[k2]=m[k]});var __exportStar=this&&this.__exportStar||function(m,exports){for(var p in m)if(p!=="default"&&!Object.prototype.hasOwnProperty.call(exports,p))__createBinding(exports,m,p)};Object.defineProperty(exports,"__esModule",{value:true});__exportStar(__webpack_require__(146),exports)},244:function(__unused_webpack_module,exports,__webpack_require__){var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:true});exports.addOptPriceInfo=void 0;const getMyCompany_1=__webpack_require__(591);const addOptSellInfo_1=__webpack_require__(35);const addOptPriceInfo=()=>__awaiter(void 0,void 0,void 0,(function*(){var _a,_b,_c,_d,_e,_f,_g,_h;const sp=new URLSearchParams(document.location.search);const factoryId=Number(sp.get("id"));const productId=Number(sp.get("product"));const tab=(_a=sp.get("tab"))!==null&&_a!==void 0?_a:"goods";const stab=(_b=sp.get("stab"))!==null&&_b!==void 0?_b:"sales";const sort=(_c=sp.get("srt"))!==null&&_c!==void 0?_c:"";const parentElement=document.querySelector("div#content div.tabbodyie form");if(!productId||!factoryId||!parentElement||stab!=="sales"){return}const{cityId}=yield(0,getMyCompany_1.getMyCompany)();const CurrQ=parseFloat((_e=(_d=document.querySelector("#boxright > div.tabbody > div > form > table > tbody > tr:nth-child(1) > td > table > tbody > tr:nth-child(2) > td:nth-child(2)"))===null||_d===void 0?void 0:_d.textContent)!==null&&_e!==void 0?_e:"0");const CityOffer=!!sort;const priceCtrlEl=document.querySelector("#price_ctrl");const priceValue=parseFloat((_g=(_f=priceCtrlEl===null||priceCtrlEl===void 0?void 0:priceCtrlEl.value)===null||_f===void 0?void 0:_f.replace(/\s+|p/gi,""))!==null&&_g!==void 0?_g:"0");const newB=document.createElement("b");newB.textContent=String(Math.round(priceValue/CurrQ*100)/100);(_h=document.querySelector("#boxright > div.tabbody > div > form > table > tbody > tr:nth-child(1) > td > table > tbody > tr:nth-child(4) > td:nth-child(1)"))===null||_h===void 0?void 0:_h.appendChild(newB);const linkQualitySort=new URLSearchParams({id:String(factoryId),tab,stab,product:String(productId)});const linkPriceSort=new URLSearchParams(linkQualitySort);linkPriceSort.append("srt","total_cost");const AddLine=[`<a href="?${linkQualitySort}">Q</a>`,`<a href="?${linkPriceSort}">Price</a><br>`].join(" | ");yield(0,addOptSellInfo_1.addOptSellInfo)({productId,idShop:factoryId,city:cityId,CityOffer,sort,CurrQ},(div=>{parentElement.after(div)}),AddLine)}));exports.addOptPriceInfo=addOptPriceInfo},468:function(__unused_webpack_module,exports,__webpack_require__){var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:true});exports.onFishfarmPage=void 0;const qualityInput_1=__webpack_require__(304);const onFishfarmPage=()=>__awaiter(void 0,void 0,void 0,(function*(){var _a;const sp=new URLSearchParams(document.location.search);const fishfarmId=Number(sp.get("id"));const tab=(_a=sp.get("tab"))!==null&&_a!==void 0?_a:"fishfarm";switch(tab){case"fishfarm":{break}case"goods":{(0,qualityInput_1.upgradeQualityInput)();break}}}));exports.onFishfarmPage=onFishfarmPage},901:function(__unused_webpack_module,exports,__webpack_require__){var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){if(k2===undefined)k2=k;var desc=Object.getOwnPropertyDescriptor(m,k);if(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable)){desc={enumerable:true,get:function(){return m[k]}}}Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){if(k2===undefined)k2=k;o[k2]=m[k]});var __exportStar=this&&this.__exportStar||function(m,exports){for(var p in m)if(p!=="default"&&!Object.prototype.hasOwnProperty.call(exports,p))__createBinding(exports,m,p)};Object.defineProperty(exports,"__esModule",{value:true});__exportStar(__webpack_require__(468),exports)},826:function(__unused_webpack_module,exports,__webpack_require__){var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){if(k2===undefined)k2=k;var desc=Object.getOwnPropertyDescriptor(m,k);if(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable)){desc={enumerable:true,get:function(){return m[k]}}}Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){if(k2===undefined)k2=k;o[k2]=m[k]});var __exportStar=this&&this.__exportStar||function(m,exports){for(var p in m)if(p!=="default"&&!Object.prototype.hasOwnProperty.call(exports,p))__createBinding(exports,m,p)};Object.defineProperty(exports,"__esModule",{value:true});__exportStar(__webpack_require__(739),exports);__exportStar(__webpack_require__(574),exports);__exportStar(__webpack_require__(371),exports);__exportStar(__webpack_require__(901),exports);__exportStar(__webpack_require__(336),exports);__exportStar(__webpack_require__(510),exports);__exportStar(__webpack_require__(791),exports);__exportStar(__webpack_require__(582),exports);__exportStar(__webpack_require__(954),exports);__exportStar(__webpack_require__(565),exports)},336:function(__unused_webpack_module,exports,__webpack_require__){var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){if(k2===undefined)k2=k;var desc=Object.getOwnPropertyDescriptor(m,k);if(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable)){desc={enumerable:true,get:function(){return m[k]}}}Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){if(k2===undefined)k2=k;o[k2]=m[k]});var __exportStar=this&&this.__exportStar||function(m,exports){for(var p in m)if(p!=="default"&&!Object.prototype.hasOwnProperty.call(exports,p))__createBinding(exports,m,p)};Object.defineProperty(exports,"__esModule",{value:true});__exportStar(__webpack_require__(602),exports)},602:function(__unused_webpack_module,exports,__webpack_require__){var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:true});exports.onMinePage=void 0;const qualityInput_1=__webpack_require__(304);const addOptPriceInfo_1=__webpack_require__(349);const onMinePage=()=>__awaiter(void 0,void 0,void 0,(function*(){var _a;const sp=new URLSearchParams(document.location.search);const mineId=Number(sp.get("id"));const tab=(_a=sp.get("tab"))!==null&&_a!==void 0?_a:"mine";switch(tab){case"mine":{break}case"goods":{(0,qualityInput_1.upgradeQualityInput)();(0,addOptPriceInfo_1.addOptPriceInfo)();break}}}));exports.onMinePage=onMinePage},349:function(__unused_webpack_module,exports,__webpack_require__){var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:true});exports.addOptPriceInfo=void 0;const getMyCompany_1=__webpack_require__(591);const addOptSellInfo_1=__webpack_require__(35);const addOptPriceInfo=()=>__awaiter(void 0,void 0,void 0,(function*(){var _a,_b,_c,_d,_e;const sp=new URLSearchParams(document.location.search);const productId=Number(sp.get("product"));const mineId=Number(sp.get("id"));const parentElement=document.querySelector("div#content div.tabbodyie form");if(!productId||!mineId||!parentElement){return}const{cityId}=yield(0,getMyCompany_1.getMyCompany)();const CurrQ=parseFloat((_b=(_a=document.querySelector("#boxright > div.tabbody > div > form > table > tbody > tr:nth-child(1) > td > table > tbody > tr:nth-child(2) > td:nth-child(2)"))===null||_a===void 0?void 0:_a.textContent)!==null&&_b!==void 0?_b:"0");const CityOffer=true;const priceCtrlEl=document.querySelector("#price_ctrl");const priceValue=parseFloat((_d=(_c=priceCtrlEl===null||priceCtrlEl===void 0?void 0:priceCtrlEl.value)===null||_c===void 0?void 0:_c.replace(/\s+|p/gi,""))!==null&&_d!==void 0?_d:"0");const newB=document.createElement("b");newB.textContent=String(Math.round(priceValue/CurrQ*100)/100);(_e=document.querySelector("#boxright > div.tabbody > div > form > table > tbody > tr:nth-child(1) > td > table > tbody > tr:nth-child(4) > td:nth-child(1)"))===null||_e===void 0?void 0:_e.appendChild(newB);yield(0,addOptSellInfo_1.addOptSellInfo)({productId,idShop:mineId,city:cityId,CityOffer,sort:"",CurrQ},(div=>{parentElement.after(div)}))}));exports.addOptPriceInfo=addOptPriceInfo},510:function(__unused_webpack_module,exports,__webpack_require__){var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){if(k2===undefined)k2=k;var desc=Object.getOwnPropertyDescriptor(m,k);if(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable)){desc={enumerable:true,get:function(){return m[k]}}}Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){if(k2===undefined)k2=k;o[k2]=m[k]});var __exportStar=this&&this.__exportStar||function(m,exports){for(var p in m)if(p!=="default"&&!Object.prototype.hasOwnProperty.call(exports,p))__createBinding(exports,m,p)};Object.defineProperty(exports,"__esModule",{value:true});__exportStar(__webpack_require__(642),exports)},642:function(__unused_webpack_module,exports,__webpack_require__){var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:true});exports.onSawmillPage=void 0;const qualityInput_1=__webpack_require__(304);const onSawmillPage=()=>__awaiter(void 0,void 0,void 0,(function*(){var _a;const sp=new URLSearchParams(document.location.search);const sawmillId=Number(sp.get("id"));const tab=(_a=sp.get("tab"))!==null&&_a!==void 0?_a:"sawmill";switch(tab){case"sawmill":{break}case"goods":{(0,qualityInput_1.upgradeQualityInput)();break}}}));exports.onSawmillPage=onSawmillPage},791:function(__unused_webpack_module,exports,__webpack_require__){var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){if(k2===undefined)k2=k;var desc=Object.getOwnPropertyDescriptor(m,k);if(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable)){desc={enumerable:true,get:function(){return m[k]}}}Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){if(k2===undefined)k2=k;o[k2]=m[k]});var __exportStar=this&&this.__exportStar||function(m,exports){for(var p in m)if(p!=="default"&&!Object.prototype.hasOwnProperty.call(exports,p))__createBinding(exports,m,p)};Object.defineProperty(exports,"__esModule",{value:true});__exportStar(__webpack_require__(780),exports)},780:function(__unused_webpack_module,exports,__webpack_require__){var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:true});exports.onShopPage=void 0;const markUniqGoods_1=__webpack_require__(499);const onShopPage=()=>__awaiter(void 0,void 0,void 0,(function*(){var _a;const sp=new URLSearchParams(document.location.search);const shopId=Number(sp.get("id"));const tab=(_a=sp.get("tab"))!==null&&_a!==void 0?_a:"shop";switch(tab){case"shop":{break}case"goods":{break}case"divisions":{(0,markUniqGoods_1.markUniqGoods)();break}}}));exports.onShopPage=onShopPage},499:(__unused_webpack_module,exports)=>{Object.defineProperty(exports,"__esModule",{value:true});exports.markUniqGoods=void 0;const markUniqGoods=()=>{const imageEls=document.querySelectorAll("#content > div.pad12 > form > table.goods > tbody > tr > td.int.hidecompact > a > img");const stI={};imageEls.forEach((({src})=>{var _a;stI[src]=1+((_a=stI[src])!==null&&_a!==void 0?_a:0)}));imageEls.forEach((image=>{if(stI[image.src]==1){image.border="2"}}))};exports.markUniqGoods=markUniqGoods},954:function(__unused_webpack_module,exports,__webpack_require__){var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:true});exports.onVendorSelectPage=void 0;const vendorsTable_1=__webpack_require__(254);const onVendorSelectPage=()=>__awaiter(void 0,void 0,void 0,(function*(){(0,vendorsTable_1.upgradeVendorsTable)()}));exports.onVendorSelectPage=onVendorSelectPage},582:function(__unused_webpack_module,exports,__webpack_require__){var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){if(k2===undefined)k2=k;var desc=Object.getOwnPropertyDescriptor(m,k);if(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable)){desc={enumerable:true,get:function(){return m[k]}}}Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){if(k2===undefined)k2=k;o[k2]=m[k]});var __exportStar=this&&this.__exportStar||function(m,exports){for(var p in m)if(p!=="default"&&!Object.prototype.hasOwnProperty.call(exports,p))__createBinding(exports,m,p)};Object.defineProperty(exports,"__esModule",{value:true});__exportStar(__webpack_require__(634),exports)},187:function(__unused_webpack_module,exports,__webpack_require__){var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:true});exports.addOptPriceInfo=void 0;const getMyCompany_1=__webpack_require__(591);const addOptSellInfo_1=__webpack_require__(35);const addOptPriceInfo=()=>__awaiter(void 0,void 0,void 0,(function*(){var _a,_b,_c,_d,_e;const sp=new URLSearchParams(document.location.search);const productId=Number(sp.get("product"));const warehouseId=Number(sp.get("id"));const parentElement=document.querySelector("div#content div.tabbodyie form");if(!productId||!warehouseId||!parentElement){return}const{cityId}=yield(0,getMyCompany_1.getMyCompany)();const CurrQ=parseFloat((_b=(_a=document.querySelector("#boxright > div.tabbody > div > form > table > tbody > tr:nth-child(1) > td > table > tbody > tr:nth-child(2) > td:nth-child(2)"))===null||_a===void 0?void 0:_a.textContent)!==null&&_b!==void 0?_b:"0");const CityOffer=true;const priceCtrlEl=document.querySelector("#price_ctrl");const priceValue=parseFloat((_d=(_c=priceCtrlEl===null||priceCtrlEl===void 0?void 0:priceCtrlEl.value)===null||_c===void 0?void 0:_c.replace(/\s+|p/gi,""))!==null&&_d!==void 0?_d:"0");const newB=document.createElement("b");newB.textContent=String(Math.round(priceValue/CurrQ*100)/100);(_e=document.querySelector("#boxright > div.tabbody > div > form > table > tbody > tr:nth-child(1) > td > table > tbody > tr:nth-child(4) > td:nth-child(1)"))===null||_e===void 0?void 0:_e.appendChild(newB);yield(0,addOptSellInfo_1.addOptSellInfo)({productId,idShop:warehouseId,city:cityId,CityOffer,sort:"",CurrQ},(div=>{parentElement.after(div)}))}));exports.addOptPriceInfo=addOptPriceInfo},634:function(__unused_webpack_module,exports,__webpack_require__){var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:true});exports.onWarehousePage=void 0;const addOptPriceInfo_1=__webpack_require__(187);const onWarehousePage=()=>__awaiter(void 0,void 0,void 0,(function*(){var _a;const sp=new URLSearchParams(document.location.search);const warehouseId=Number(sp.get("id"));const tab=(_a=sp.get("tab"))!==null&&_a!==void 0?_a:"warehouse";switch(tab){case"warehouse":{break}case"goods":{(0,addOptPriceInfo_1.addOptPriceInfo)();break}case"supply":{break}}}));exports.onWarehousePage=onWarehousePage},565:function(__unused_webpack_module,exports){var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:true});exports.onWeeklyPacksPage=void 0;const onWeeklyPacksPage=()=>__awaiter(void 0,void 0,void 0,(function*(){const qualificationEl=document.querySelectorAll("#content > div.tabbody > div > form > table > tbody > tr > td > div > table > tbody > tr:nth-child(3) > td > b");const priceEl=document.querySelectorAll("#content > div.tabbody > div > form > table > tbody > tr > td > div > table > tbody > tr:nth-child(4) > td > div > a > span");[...priceEl].forEach((function(i,ind){var _a,_b,_c,_d;const points=Number(qualificationEl[ind].textContent);const price=parseFloat((_b=(_a=i.textContent)===null||_a===void 0?void 0:_a.replace(/[^\d]/g,""))!==null&&_b!==void 0?_b:"0");const pointsPrice=Math.round(price*100/points)/100;const suffix=(_d=(_c=i.textContent)===null||_c===void 0?void 0:_c.replace(/\d/g,""))!==null&&_d!==void 0?_d:"";qualificationEl[ind].textContent+=` (${pointsPrice}${suffix})`}))}));exports.onWeeklyPacksPage=onWeeklyPacksPage},591:function(__unused_webpack_module,exports){var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:true});exports.getMyCompany=void 0;const getMyCompany=()=>__awaiter(void 0,void 0,void 0,(function*(){var _a,_b,_c,_d,_e,_f,_g,_h,_j,_k,_l,_m,_o,_p,_q,_r;const mainScript=(_b=(_a=document.querySelectorAll("#divmenu.menucontainer script")[1])===null||_a===void 0?void 0:_a.textContent)!==null&&_b!==void 0?_b:"";const companyId=(_e=parseInt((_d=(_c=mainScript.match(/company\?id=(\d+)/))===null||_c===void 0?void 0:_c[1])!==null&&_d!==void 0?_d:"0"))!==null&&_e!==void 0?_e:0;const citySrc=(_q=(_p=(_o=(_m=(_l=(_k=(_j=(_h=(_g=(_f=document.querySelector("table.unith tbody"))===null||_f===void 0?void 0:_f.rows)===null||_g===void 0?void 0:_g[1])===null||_h===void 0?void 0:_h.cells)===null||_j===void 0?void 0:_j[4])===null||_k===void 0?void 0:_k.querySelectorAll("a"))===null||_l===void 0?void 0:_l[1])===null||_m===void 0?void 0:_m.href)===null||_o===void 0?void 0:_o.split("="))===null||_p===void 0?void 0:_p[1])!==null&&_q!==void 0?_q:"0";const cityId=(_r=parseInt(citySrc))!==null&&_r!==void 0?_r:0;return{companyId,cityId}}));exports.getMyCompany=getMyCompany},117:function(__unused_webpack_module,exports,__webpack_require__){var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:true});exports.getOptVendors=exports.getOptPriceQuality=void 0;const loader_1=__webpack_require__(584);const getMyCompany_1=__webpack_require__(591);const getOptPriceQuality=args=>__awaiter(void 0,void 0,void 0,(function*(){const doc=yield getOptDoc(args);if(!doc){return}const R=doc.querySelector("td#boxright.boxright table.datatable tbody");if(!R||R.rows[0].cells[0].classList.contains("tblempty")){return}const{companyId}=yield(0,getMyCompany_1.getMyCompany)();const firstNotMyRow=[...R.rows].find((row=>{const hrf=row.cells[2].querySelector("a");const sP=hrf?parseInt(hrf.href.split("=").slice(-1)[0]):-1;return sP!==companyId}));if(!firstNotMyRow){return}const qualityCell=firstNotMyRow.cells[6];const quality=parseFloat(qualityCell.innerText.replace(/\s+|p/gi,""));const priceCell=firstNotMyRow.cells[11];const price=parseFloat(priceCell.innerText.replace(/\s+|p/gi,""));return price/quality}));exports.getOptPriceQuality=getOptPriceQuality;const getOptVendors=args=>__awaiter(void 0,void 0,void 0,(function*(){var _a,_b,_c,_d;const doc=yield getOptDoc(args);if(!doc){return[]}const tbodyEl=doc.querySelector("td#boxright.boxright table.datatable tbody");if(!tbodyEl||!tbodyEl.rows[0].cells.length){return[]}const{companyId}=yield(0,getMyCompany_1.getMyCompany)();const returnValue=[...tbodyEl.rows].map((({cells})=>{const nmCell=cells[2];const nm=nmCell.innerText;const linkSp=nmCell.querySelector("a");const sP=linkSp?parseInt(linkSp.href.split("=").slice(-1)[0]):0;const linkSpv=cells[1].querySelector("a");const sPv=linkSpv?parseInt(linkSpv.href.split("=").slice(-1)[0]):0;const addr=cells[4].innerText;const stock=parseFloat(cells[5].innerText.replace(/\s+/gi,""));const quality=parseFloat(cells[6].innerText.replace(/\s+/gi,""));const days=parseFloat(cells[9].innerText.replace(/[^\d]/gi,""));const deliver=parseFloat(cells[8].innerText.replace(/\s+|p/gi,""));const customs=parseFloat(cells[10].innerText.replace(/\s+|p/gi,""));const price=parseFloat(cells[11].innerText.replace(/\s+|p/gi,""));return{isMine:sP==companyId,companyTitle:nm,cityTitle:addr,amount:stock,totalPrice:price,quality,priceQuality:price/quality,buildingId:sPv,deliveryDays:days-(deliver==0?1:0),deliveryPrice:deliver,customs}}));if(!args.allPages){return returnValue}const scriptText=(_b=(_a=doc.querySelector(".tblpages > script"))===null||_a===void 0?void 0:_a.text)!==null&&_b!==void 0?_b:"";const mPage=parseInt((_d=(_c=/createPGNavigator\("vendors","vendorsfrm","p",1,(\d+),/g.exec(scriptText))===null||_c===void 0?void 0:_c[1])!==null&&_d!==void 0?_d:"1");if(mPage===1){return returnValue}const promises=[];for(let p=2;p<=mPage;p++){promises.push((0,exports.getOptVendors)(Object.assign(Object.assign({},args),{page:p,allPages:false})))}const pages=yield Promise.all(promises);return returnValue.concat(...pages.flat())}));exports.getOptVendors=getOptVendors;const getOptDoc=_e=>__awaiter(void 0,[_e],void 0,(function*({productId:id,cityId:city,cityOffer:CityOffer,sortOrder,page=1}){const url=`https://bizmania.ru/analitics/vendors/?product=${id}&type=vendor&city=${city}`+(sortOrder!==""?`&sort=${sortOrder}`:"")+(page!=1?`&p=${page}`:"")+(CityOffer?"&cityOffersOnly=on":"");return(0,loader_1.getHtml)(url)}))},892:function(__unused_webpack_module,exports,__webpack_require__){var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:true});exports.loadQBase=exports.getQBase=void 0;const loader_1=__webpack_require__(584);const getQBase=factoryId=>{const data=sessionStorage.getItem(`P${factoryId}d`);if(data){return JSON.parse(data)}return(0,exports.loadQBase)(factoryId)};exports.getQBase=getQBase;const loadQBase=(factoryId_1,...args_1)=>__awaiter(void 0,[factoryId_1,...args_1],void 0,(function*(factoryId,download=false){const dlp=document.location.pathname;const searchParams=new URLSearchParams(document.location.search);const isLocal="/units/factory/"===dlp&&searchParams.get("tab")==="goods"&&!searchParams.get("product");if(!isLocal&&!download){return}const s1=isLocal?document:yield(0,loader_1.getHtml)(`https://bizmania.ru/units/factory/?id=${factoryId}&tab=goods`);if(!s1){return}const shemes={};const goods={};const urls=["https://bizmania.ru/img/sprite/","https://bizmania.ru/img/products/"];const divisionRows=[...s1.querySelectorAll("#produce > tbody > tr")];const divisions=divisionRows.map((el=>{var _a,_b,_c,_d,_e,_f,_g,_h,_j;return{img:(_c=(_b=(_a=el.cells[0])===null||_a===void 0?void 0:_a.querySelector("img"))===null||_b===void 0?void 0:_b.src.split("/").pop())!==null&&_c!==void 0?_c:"",title:(_f=(_e=(_d=el.cells[1])===null||_d===void 0?void 0:_d.querySelector("a"))===null||_e===void 0?void 0:_e.textContent)!==null&&_f!==void 0?_f:"",divisionId:Number((_j=(_h=(_g=el.cells[11])===null||_g===void 0?void 0:_g.querySelector("a"))===null||_h===void 0?void 0:_h.href.match(/id=(\d+)/))===null||_j===void 0?void 0:_j[1])}}));const fractionToNumber=v=>{const vv=v.split("/");return vv&&vv.length==2?parseFloat(vv[0])/parseFloat(vv[1]):parseFloat(v)};const promises=divisions.map((_a=>__awaiter(void 0,[_a],void 0,(function*({divisionId}){const schemeDialogFrame=yield(0,loader_1.getHtml)(`https://bizmania.ru/units/produce/scheme/?id=${divisionId}`);if(!schemeDialogFrame){return}const schemeRows=[...schemeDialogFrame.querySelectorAll("form[name=schemeForm] > table.datatable > tbody > tr")];shemes[divisionId]=schemeRows.map((({cells})=>{var _a,_b,_c,_d,_e,_f,_g,_h,_j,_k,_l,_m;const[imageCell,titleCell,produceCell,consumeCell,sourceCell]=cells;const image=(_b=(_a=imageCell.querySelector("img"))===null||_a===void 0?void 0:_a.src)!==null&&_b!==void 0?_b:"";const title=(_c=titleCell.textContent)!==null&&_c!==void 0?_c:"";const produce=parseFloat((_d=produceCell===null||produceCell===void 0?void 0:produceCell.textContent)!==null&&_d!==void 0?_d:"0");const consume=parseFloat((_e=consumeCell===null||consumeCell===void 0?void 0:consumeCell.textContent)!==null&&_e!==void 0?_e:"0");goods[title]=(_f=image.split("/").pop())!==null&&_f!==void 0?_f:"";const sources=[];const dc=sourceCell.querySelectorAll("table tr")[0].cells;for(let i=0;i<dc.length;i=i+2){const sourceProductCell=dc[i];const sourceAmountCell=dc[i+1];const sourceProductImage=sourceProductCell.querySelector("img");const sourceTitle=(_g=sourceProductImage===null||sourceProductImage===void 0?void 0:sourceProductImage.title)!==null&&_g!==void 0?_g:"";goods[sourceTitle]=(_h=sourceProductImage===null||sourceProductImage===void 0?void 0:sourceProductImage.src.split("/").pop())!==null&&_h!==void 0?_h:"";sources.push({title:sourceTitle,qualityPart:parseInt((_k=(_j=sourceProductCell.textContent)===null||_j===void 0?void 0:_j.replace(/%/gi,""))!==null&&_k!==void 0?_k:"0"),amount:fractionToNumber((_m=(_l=sourceAmountCell.textContent)===null||_l===void 0?void 0:_l.replace(/x /gi,""))!==null&&_m!==void 0?_m:"0")})}return{title,produce,consume,sources}}))}))));yield Promise.all(promises);const value={data:shemes,goods,prod:divisions,urls};sessionStorage.setItem(`P${factoryId}d`,JSON.stringify(value));return value}));exports.loadQBase=loadQBase},35:function(__unused_webpack_module,exports,__webpack_require__){var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:true});exports.addOptSellInfo=void 0;const getOptPrices_1=__webpack_require__(117);const formatNumber_1=__webpack_require__(897);const addOptSellInfo=(_a,mount_1,...args_1)=>__awaiter(void 0,[_a,mount_1,...args_1],void 0,(function*({productId,idShop,city,CityOffer,sort,CurrQ,addHead},mount,AddLine=""){const html=yield getOptSellHtml({productId,idShop,CurrVendor:-1,arDParam:{city,CityOffer,important:false,sort},CityQ:0,CurrQ,hideSet:true,addHead,styles:"max-width: 100%;",setQ:true});const newElement=document.createElement("div");newElement.style.setProperty("float","left");newElement.innerHTML=AddLine+html;mount(newElement)}));exports.addOptSellInfo=addOptSellInfo;const getOptSellHtml=_b=>__awaiter(void 0,[_b],void 0,(function*({productId,idShop,CurrVendor,arDParam,CityQ,CurrQ,hideSet,addHead="",styles="max-width: 550px; width:100%",setQ=false}){const vendors=yield(0,getOptPrices_1.getOptVendors)({productId,cityId:arDParam.city,cityOffer:typeof arDParam.CityOffer!=="undefined"?arDParam.CityOffer:false,important:typeof arDParam.important!=="undefined"?arDParam.important:false,sortOrder:typeof arDParam.sort!=="undefined"?arDParam.sort:""});const arDString=vendors.reduce(((acc,vendor,ind)=>{const{amount,buildingId,cityTitle,companyTitle,customs,deliveryDays,deliveryPrice,isMine,priceQuality,quality,totalPrice}=vendor;const companyStyle=buildingId==CurrVendor?"background-color: rgb(198, 236, 255);":"";const companyValue=isMine?"<b>"+companyTitle+"</b>":companyTitle;const newPrice=CurrQ*priceQuality;const priceStyle=CityQ>0&&CityQ<priceQuality?"background-color: lightpink; text-decoration: line-through;":"";return acc+`<tr class="tbl${ind%2?"g":""}r">`+`   <td style="${companyStyle}">${companyValue}</td>`+`   <td title="${deliveryPrice} + ${customs}">${cityTitle}${deliveryDays>0?"&nbsp;<b> &#"+(9311+deliveryDays)+";</b>":""}</td>`+`   <td align=right><nobr>${(0,formatNumber_1.formatNumber)(amount.toFixed(0))}</nobr></td>`+`   <td align=center>${quality}</td>`+`   <td align=right><nobr>${(0,formatNumber_1.formatMoney)(totalPrice.toFixed(totalPrice>100?0:2))}</nobr></td>`+`   <td align=center style="${priceStyle}">`+(setQ?`<a href=# onclick="document.querySelector('#price_ctrl').value='${newPrice.toFixed(newPrice>100?0:2)}'; document.getElementById('submit').style.display='inline'; return false;">${(0,formatNumber_1.formatMoney)(priceQuality.toFixed(priceQuality>100?0:2))}</a>`:(0,formatNumber_1.formatMoney)(priceQuality.toFixed(priceQuality>100?0:2)))+`</td>`+(addHead?"<td data-id="+buildingId+(priceQuality<CurrQ||isNaN(CurrQ)?' style="background-color: lightgreen;"':"")+"><nobr>"+(hideSet?"":'<button data-type=set class=AddToStockGoods onclick="return false;">&#128722;</button> ')+'<input type=number value=0 class=smA style="width:70px"><button data-type=buy class=AddToStockGoods onclick="return false;">&#10009;</button></nobr></td>':"")+`</tr>`}),"");return`<table data-idProd=${productId} data-idShop=${idShop} data-CurrVendor=${CurrVendor} class="datatable" cellpadding="5" cellspacing="0" border="0" style="${styles}">`+`   <thead><tr class="tblhr">`+`       <td class="tblh1">Компания</td>`+`       <td class="tblh">Город</td>`+`       <td class="tblh">Объем</td>`+`       <td class="tblh">Качество</td>`+`       <td class="tblh">Цена</td>`+`       <td class="tblh">за качество</td>${addHead}`+`   </tr></thead>`+`   <tbody>${arDString}</tbody>`+`</table>`}))},793:function(__unused_webpack_module,exports){var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:true});exports.upgradeMainMenu=void 0;const upgradeMainMenu=myCompanyId=>__awaiter(void 0,void 0,void 0,(function*(){const LINKS=[{url:"/wikihelp/?topic=%D0%92%D0%B8%D0%B4%D1%8B+%D0%BF%D1%80%D0%B5%D0%B4%D0%BF%D1%80%D0%B8%D1%8F%D1%82%D0%B8%D0%B9&unit=shop.food",text:"Food wiki"},{url:`/company/?id=${myCompanyId}&tab=reports&section=accountlog&category=1&trantype=income`,text:"Income"},{url:`/company/?id=${myCompanyId}&tab=reports&section=accountlog&category=1&trantype=distribute+tender+redemption`,text:"Income Tender"}];const dm=document.querySelectorAll("div#divmenu div.smenu table tbody ")[4];if(!dm){return}LINKS.forEach((({url,text})=>{const linkRow=document.createElement("tr");const linkCell=document.createElement("td");const linkLink=document.createElement("a");linkLink.setAttribute("onclick","this.blur()");linkLink.className="smenulnk";linkCell.setAttribute("colspan","3");linkCell.setAttribute("nowrap","");linkRow.className="smenutd";linkLink.setAttribute("href",url);linkLink.text=` ${text} `;linkCell.appendChild(linkLink);linkRow.appendChild(linkCell);dm.appendChild(linkRow)}))}));exports.upgradeMainMenu=upgradeMainMenu},304:(__unused_webpack_module,exports)=>{Object.defineProperty(exports,"__esModule",{value:true});exports.upgradeQualityInput=void 0;const upgradeQualityInput=()=>{const elements=document.querySelectorAll("#produce > tbody > tr > td:nth-child(13)  > div");[...elements].forEach((el=>{var _a,_b;const inputEl=el.querySelector("input");if(!inputEl){return}const index=parseInt(inputEl.name.replace(/[^\d]/gi,""));const qualityCell=document.getElementById("dr_"+index);const qualityValue=parseFloat((_a=qualityCell===null||qualityCell===void 0?void 0:qualityCell.textContent)!==null&&_a!==void 0?_a:"1");const html=`<input\n            step="0.01"\n            type="number"\n            value="${qualityValue}"\n            onchange="document.getElementById('dressing[${index}]_ctrl').value=\n                    (this.value - products[${index}][5])/(products[${index}][6] - products[${index}][5]);\n                changeRow(${index});\n                return false;"\n        >`;const newInputEl=document.createElement("input");el.style.display="none";(_b=el.parentElement)===null||_b===void 0?void 0:_b.appendChild(newInputEl);newInputEl.outerHTML=html}))};exports.upgradeQualityInput=upgradeQualityInput},254:function(__unused_webpack_module,exports,__webpack_require__){var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:true});exports.upgradeVendorsTable=void 0;const formatNumber_1=__webpack_require__(897);const upgradeVendorsTable=()=>__awaiter(void 0,void 0,void 0,(function*(){const dd=document.querySelector("#vendorstbl");if(!dd){return}addFooterInfo(dd);const Price=dd.querySelector("tbody >tr > td:last-child").cellIndex+1;const mark="price";const Ck=0;if(mark==="price"){const priceCells=dd.querySelectorAll("tbody > tr > td:nth-child("+Price+")");priceCells.forEach((function(cell,row){const b=document.createElement("b");cell.appendChild(b);const c=calcK(dd,cell,row);if(Ck){b.style.color=c<=Ck?"green":"red"}b.textContent=" "+(0,formatNumber_1.formatMoney)(c.toFixed(c>100?0:2))}))}}));exports.upgradeVendorsTable=upgradeVendorsTable;const addFooterInfo=dd=>{var _a,_b,_c,_d;const dd2=dd.querySelector("tfoot > tr > td:nth-child(4)");if(!dd2){return}if(dd2.textContent==="Среднее по городу:"){const dd3=dd.querySelector("tfoot > tr > td:nth-child(8)")?dd.querySelector("tfoot > tr > td:nth-child(8)"):dd.querySelector("tfoot > tr > td:nth-child(6)");if(dd3){const C1=parseFloat((_b=(_a=dd3.textContent)===null||_a===void 0?void 0:_a.replace(/(p\.|\s)+/g,""))!==null&&_b!==void 0?_b:"");const C2=parseFloat((_d=(_c=dd.querySelector("tfoot > tr > td:nth-child(5)"))===null||_c===void 0?void 0:_c.textContent)!==null&&_d!==void 0?_d:"");const Ck=C1/C2;dd3.textContent+=" "+(0,formatNumber_1.formatMoney)(Ck.toFixed(Ck>100?0:2))}}};const calcK=(dd,i,row)=>{var _a,_b,_c;const cells=dd.querySelectorAll("tbody > tr > td:nth-child(9)");const cell=cells[row];const priceValue=parseFloat((_b=(_a=i.textContent)===null||_a===void 0?void 0:_a.replace(/(p\.|\s)+/g,""))!==null&&_b!==void 0?_b:"");return priceValue/parseFloat((_c=cell===null||cell===void 0?void 0:cell.textContent)!==null&&_c!==void 0?_c:"")}},478:function(__unused_webpack_module,exports){var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:true});exports.addFontAwesome=void 0;let fontAwesomeAdded=false;const addFontAwesome=()=>__awaiter(void 0,void 0,void 0,(function*(){if(fontAwesomeAdded){return}fontAwesomeAdded=true;createStyleSheet("https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css");addCSStyle([{name:"fa-check",type:".",properties:[{color:"green"}]}])}));exports.addFontAwesome=addFontAwesome;function createStyleSheet(href){let element;if(typeof href!=="undefined"){element=document.createElement("link");element.type="text/css";element.rel="stylesheet";element.href=href}else{element=document.createElement("style");element.type="text/css"}document.getElementsByTagName("head")[0].appendChild(element);let sheet=document.styleSheets[document.styleSheets.length-1];if(typeof sheet.addRule==="undefined"){sheet.addRule=(selectorText,cssText,index)=>{if(typeof index==="undefined"){index=sheet.cssRules.length}return sheet.insertRule(selectorText+" {"+cssText+"}",index)}}if(typeof sheet.removeRule==="undefined"){sheet.removeRule=sheet.deleteRule}return sheet}function addCSStyle(classes){const sheetN=createStyleSheet();classes.forEach((classItem=>{for(let propertyObj of classItem.properties){for(let property in propertyObj){sheetN.addRule(`${classItem.type}${classItem.name}`,`${property}: ${propertyObj[property]}`)}}}))}},897:(__unused_webpack_module,exports)=>{Object.defineProperty(exports,"__esModule",{value:true});exports.formatNumber=exports.formatMoney=void 0;const moneyFormat=new Intl.NumberFormat("ru-RU",{style:"currency",currency:"RUB",signDisplay:"auto",minimumFractionDigits:0,maximumFractionDigits:2});const formatMoney=val=>{const value=parseFloat(val);return isNaN(value)?val:moneyFormat.format(value).replace(" "," ").replace(",",".").replace("₽","р.")};exports.formatMoney=formatMoney;const formatNumber=val=>{const value=parseFloat(val);return isNaN(value)?val:value.toLocaleString("ru-RU").replace(",",".")};exports.formatNumber=formatNumber},584:function(__unused_webpack_module,exports){var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:true});exports.getHtml=void 0;const getHtml=url=>__awaiter(void 0,void 0,void 0,(function*(){const response=yield fetch(url);if(!response.ok){return}const htmlString=yield response.text();const frame=document.createElement("frame");frame.innerHTML=htmlString.trim();if(!frame.innerText){return}return frame}));exports.getHtml=getHtml}};var __webpack_module_cache__={};function __webpack_require__(moduleId){var cachedModule=__webpack_module_cache__[moduleId];if(cachedModule!==undefined){return cachedModule.exports}var module=__webpack_module_cache__[moduleId]={exports:{}};__webpack_modules__[moduleId].call(module.exports,module,module.exports,__webpack_require__);return module.exports}var __webpack_exports__=__webpack_require__(821)})();
// ==UserScript==
// @name bm-userscript
// @version 7.2.2
// @namespace https://github.com/bizmania
// @description Visual improvements for bizmania.ru
// @author bizmania
// @homepage https://github.com/bizmania/bm-userscript#readme
// @updateURL https://bizmania.github.io/plugin/bm-userscript.meta.js
// @downloadURL https://bizmania.github.io/plugin/bm-userscript.user.js
// @license https://opensource.org/licenses/MIT
// @match https://bizmania.ru/*
// @require https://cdn.jsdelivr.net/npm/@trim21/gm-fetch@0.1.15
// @require https://cdn.jsdelivr.net/npm/axios@1.6.8
// @connect bizmania.github.io
// @connect bizmania.ru
// @grant GM.xmlHttpRequest
// ==/UserScript==

(()=>{"use strict";var __webpack_modules__={964:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:true});exports.onCalculatorPage=void 0;const addDownloadButton_1=__webpack_require__(6);const addProductsFilter_1=__webpack_require__(420);const addProductsPane_1=__webpack_require__(52);const onCalculatorPage=async()=>{(0,addProductsFilter_1.addProductsFilter)();(0,addProductsPane_1.addProductsPane)();(0,addDownloadButton_1.addDownloadButton)()};exports.onCalculatorPage=onCalculatorPage},739:function(__unused_webpack_module,exports,__webpack_require__){var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){if(k2===undefined)k2=k;var desc=Object.getOwnPropertyDescriptor(m,k);if(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable)){desc={enumerable:true,get:function(){return m[k]}}}Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){if(k2===undefined)k2=k;o[k2]=m[k]});var __exportStar=this&&this.__exportStar||function(m,exports){for(var p in m)if(p!=="default"&&!Object.prototype.hasOwnProperty.call(exports,p))__createBinding(exports,m,p)};Object.defineProperty(exports,"__esModule",{value:true});__exportStar(__webpack_require__(964),exports)},6:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:true});exports.addDownloadButton=void 0;const addFontAwesome_1=__webpack_require__(478);const addDownloadButton=async()=>{const linkHolderEl=document.querySelector("div.pad12 div.pad12 h3");const padH3Els=document.querySelectorAll("div.pad12 h3");const tableEl=document.querySelector(".datatable");const rowEls=tableEl?.tBodies[0]?.rows;if(!padH3Els.length||!rowEls||!linkHolderEl){return}const name=padH3Els[3]?.innerText??"";const rows=[...rowEls].map((({cells})=>[name,cells[0].innerText,cells[1].innerText,parseFloat(cells[2].innerText),parseFloat(cells[4].innerText.replace(/\s+/g,""))]));const csvContent="data:text/csv;charset=utf-8,"+rows.map((e=>e.join(","))).join("\n")+"\n";const encodedUri=encodeURI(csvContent);const link=document.createElement("a");link.setAttribute("href",encodedUri);link.setAttribute("download",`prod.${name}.csv`);link.text=" [ Скачать данные ]";let i_elem=document.createElement("i");i_elem.classList.add("fa");i_elem.classList.add("fa-file-excel-o");i_elem.setAttribute("aria-hidden","true");link.appendChild(i_elem);linkHolderEl.appendChild(link);(0,addFontAwesome_1.addFontAwesome)()};exports.addDownloadButton=addDownloadButton},420:(__unused_webpack_module,exports)=>{Object.defineProperty(exports,"__esModule",{value:true});exports.addProductsFilter=void 0;const addProductsFilter=async()=>{const productsIframeEl=document.querySelector("#product_frm");const frm=productsIframeEl?.contentWindow?.document;if(!frm){return}const tableEl=frm.querySelector("table");const tableCells=[...frm.querySelectorAll("td")];const elI=document.createElement("input");elI.type="text";elI.placeholder="поиск ... ";elI.onkeyup=event=>{const value=event.target.value;tableCells.forEach((td=>{td.style.display=(td.textContent??"").toLowerCase().includes(value.toLowerCase())?"":"none"}))};tableEl?.parentElement?.insertBefore(elI,tableEl)};exports.addProductsFilter=addProductsFilter},52:(__unused_webpack_module,exports)=>{Object.defineProperty(exports,"__esModule",{value:true});exports.addProductsPane=void 0;const addProductsPane=async()=>{const selectEl=document.querySelector("#content > form > div:nth-child(1) > table > tbody > tr:nth-child(1) > td:nth-child(2) > select");const productsIframeEl=document.querySelector("#product_frm");const frm=productsIframeEl?.contentWindow?.document;if(!selectEl||!frm){return}const cityId=selectEl.value;const imageEls=frm.querySelectorAll("td > img");const newLinkEls=[...imageEls].map((imageEl=>{const newLinkEl=document.createElement("a");const newImageEl=document.createElement("img");const nextCell=imageEl.parentNode?.nextSibling;const linkEl=nextCell?.querySelector("a");const productId=linkEl?.href?.match(/productComboSelect\(\"product\",(\d+),/)?.[1]??"0";newLinkEl.title=linkEl?.textContent??"";newLinkEl.href=`/units/produce/calculator/?product=${productId}&city=${cityId}`;newLinkEl.appendChild(newImageEl);newImageEl.src=imageEl.src;return newLinkEl}));const newCellEl=document.createElement("td");newCellEl.colSpan=6;const newRowEl=document.createElement("tr");newRowEl.appendChild(newCellEl);const tableBodyEl=document.querySelector("#content > form > div:nth-child(1) > table > tbody");tableBodyEl?.appendChild(newRowEl);newLinkEls.forEach((el=>{newCellEl.appendChild(el);newCellEl.appendChild(document.createTextNode(" "))}))};exports.addProductsPane=addProductsPane},426:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:true});exports.onConstructionPage=void 0;const hideEmptyRequired_1=__webpack_require__(566);const onConstructionPage=async()=>{const sp=new URLSearchParams(document.location.search);const constructionId=Number(sp.get("id"));const productId=Number(sp.get("product"));const tab=sp.get("tab")??"unit";switch(tab){case"unit":{break}case"goods":{(0,hideEmptyRequired_1.hideEmptyRequirements)();break}}};exports.onConstructionPage=onConstructionPage},574:function(__unused_webpack_module,exports,__webpack_require__){var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){if(k2===undefined)k2=k;var desc=Object.getOwnPropertyDescriptor(m,k);if(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable)){desc={enumerable:true,get:function(){return m[k]}}}Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){if(k2===undefined)k2=k;o[k2]=m[k]});var __exportStar=this&&this.__exportStar||function(m,exports){for(var p in m)if(p!=="default"&&!Object.prototype.hasOwnProperty.call(exports,p))__createBinding(exports,m,p)};Object.defineProperty(exports,"__esModule",{value:true});__exportStar(__webpack_require__(426),exports)},566:(__unused_webpack_module,exports)=>{Object.defineProperty(exports,"__esModule",{value:true});exports.hideEmptyRequirements=void 0;const hideEmptyRequirements=async()=>{const cell2=document.querySelector("#content > div.pad12 > form > div:nth-child(1) > table:nth-child(1) > thead > tr:nth-child(1) > td:nth-child(2)");if(!cell2){return}let newLinkEl=document.createElement("a");newLinkEl.textContent=" [hide]";newLinkEl.style.color="#5165a4";newLinkEl.href="#";newLinkEl.id="hideZero";newLinkEl.addEventListener("click",(()=>{const hideEls=document.querySelectorAll("#supplytbl > tbody > tr > td:nth-child(5) > div > span > div");if(!hideEls.length){return false}[...hideEls].forEach((i=>{const value=parseInt(i?.textContent??"0");const closeRowEl=i.closest("tr");const closeValue=parseInt(closeRowEl?.cells?.[9]?.textContent??"0");if((value===0||closeValue>=value)&&closeRowEl){closeRowEl.style.display="none"}}));return false}));cell2.appendChild(newLinkEl)};exports.hideEmptyRequirements=hideEmptyRequirements},994:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:true});exports.onEquipmentPurchasePage=void 0;const loadInfo_1=__webpack_require__(179);const filters_1=__webpack_require__(680);const formatNumber_1=__webpack_require__(897);const insertAfter_1=__webpack_require__(822);const onEquipmentPurchasePage=async()=>{const sp=new URLSearchParams(document.location.search);const divisionId=Number(sp.get("id"));const menu=document.querySelector("body > form > div.nm-tabs");const dataTable=document.querySelector("#vendorstbl.datatable");const te=document.querySelector("form[name=purchaseForm] input[name=type]");const type=parseInt(te?.value??"0");const prodEqInfo=await(0,loadInfo_1.loadInfo)(divisionId);if(!dataTable||!te||!menu||!divisionId||!type||!prodEqInfo){return}{const html=`<div style="display: flex; flex-wrap: nowrap; text-align: right; width: 100%; justify-content: space-between; flex-direction: row; align-items: center; margin: 0 10px">`+`<div>Q работников: <b>${prodEqInfo.QEmp}</b></div>`+`<div>Оборудование: <b>${prodEqInfo.CurrEq} / ${prodEqInfo.MaxEq}</b></div>`+`<button class="q" data-v="${prodEqInfo.QEq}">${prodEqInfo.QEq}${prodEqInfo.QNeed>0?"=>"+prodEqInfo.QNeed:""}</button>`+`</div>`;const dvM=document.createElement("div");menu.appendChild(dvM);dvM.style.display="flex";dvM.style.flex="1 1 auto";dvM.innerHTML=html;const button=dvM.querySelector("button.q");button?.addEventListener("click",(event=>{event.preventDefault();event.stopPropagation();return false}))}{const equipmentAmountMax=prodEqInfo.MaxEq-prodEqInfo.CurrEq;const dataRows=[...dataTable.querySelectorAll("tr")].map((row=>{if(!row.id){return}const{id,cells}=row;const amountCell=cells[6];const qualityCell=cells[8];const priceCell=cells[10];if(!amountCell||!qualityCell||!priceCell){return}const rowAmount=parseInt(amountCell.textContent?.replace(/\s/g,"")??"0");const amount=Math.min(equipmentAmountMax,rowAmount);const quality=parseFloat(qualityCell.textContent??"0");const price=parseFloat(priceCell.textContent?.replace(/\s|p\./g,"")??"0");const currentQualityEquipment=prodEqInfo.QEq*prodEqInfo.CurrEq;const proposedQualityEquipment=quality*amount;const summedQualityEquipment=currentQualityEquipment+proposedQualityEquipment;const summedAmount=amount+prodEqInfo.CurrEq;const deltaQuality=summedQualityEquipment/summedAmount-prodEqInfo.QEq;console.log("deltaQuality",deltaQuality);if(rowAmount!==amount){amountCell.innerHTML=amountCell.innerHTML.replaceAll("&nbsp;","");amountCell.style.whiteSpace="nowrap";const amountSpan=document.createElement("span");amountSpan.style.color="green";amountSpan.textContent=` (${(0,formatNumber_1.formatNumber)(amount.toFixed(0))})`;amountCell.appendChild(amountSpan)}{const span=document.createElement("span");span.style.color=deltaQuality>0?"green":"red";span.textContent=(deltaQuality>0?" +":" ")+deltaQuality.toFixed(3);qualityCell.appendChild(span)}const priceForDeltaQuality=price*amount/deltaQuality;if(!isNaN(priceForDeltaQuality)&&~~(priceForDeltaQuality*1e3)!==0){const priceSpan=document.createElement("span");const value=Math.abs(priceForDeltaQuality);const valueString=(0,formatNumber_1.formatNumber)(value.toFixed(value>100?0:2));priceSpan.innerHTML=`<img src="/img/icons/smallinfo.png" title="${valueString}">`;priceCell.appendChild(priceSpan)}return{id,deltaQuality,priceForDeltaQuality}})).filter(filters_1.notUndefined);const sortedByDeltaQuality=[...dataRows].filter((row=>~~(row.deltaQuality*1e3)>0)).sort(((a,b)=>Math.abs(b.deltaQuality)-Math.abs(a.deltaQuality)));sortedByDeltaQuality.slice(0,3).forEach((({id})=>{const selector=id.replace(/\[/g,"\\[").replace(/\]/g,"\\]");const el=dataTable.querySelector(`tr#${selector} > td:nth-child(9)`);if(el){el.style.backgroundColor="lightgreen"}}));const sortedByDeltaQualityPrice=[...dataRows].filter((row=>~~(row.deltaQuality*1e3)>0)).sort(((a,b)=>Math.abs(a.priceForDeltaQuality)-Math.abs(b.priceForDeltaQuality)));sortedByDeltaQualityPrice.slice(0,3).forEach((({id})=>{const selector=id.replace(/\[/g,"\\[").replace(/\]/g,"\\]");const el=dataTable.querySelector(`tr#${selector} > td:nth-child(11)`);if(el){el.style.backgroundColor="lightgreen"}}))}{const dv=document.createElement("div");const html=`<div style="display: flex;">\n            <div style="display: grid;grid-template-columns: 10% 10% 10%;flex: 1 1 auto;row-gap: 5px;">\n                <span>нужно всего</span>\n                <input id="ca" placeholder="нужное кач-во" type="number" min="0" step="0.01" style="width: 60px; background-color: lightgreen;" value="${prodEqInfo.QNeed}">\n                <input id="qc" placeholder="нужное кол-во" type="number" min="0" step="1"    style="width: 70px; background-color: lightgreen;" value="${prodEqInfo.MaxEq}">\n\n                <span>уже есть</span>\n                <input id="sq" placeholder="есть кач-во" type="number" min="0" step="0.01" style="width: 60px; background-color: lightgreen;" value="${prodEqInfo.QEq}">\n                <input id="sc" placeholder="есть кол-во" type="number" min="0" step="1"    style="width: 70px; background-color: lightgreen;" value="${prodEqInfo.CurrEq}">\n\n                <span>&nbsp;</span>\n                <input id="iq1" placeholder="1-й кач-во" type="number" min="0" step="0.01" style="width: 60px; background-color: white;">\n                <input id="ic1" placeholder="1-й кол-во" type="number" min="0" step="1"    style="width: 70px; background-color: white;">\n\n                <div style="display: flex;flex-direction: row;gap: 10px;grid-column: 1/4;">\n                    <span>надо до требуемого качества</span>\n                    <div><span id="isq">--</span> / <b id="isc">--</b></div>\n                </div>\n\n                <span>&nbsp;</span>\n                <input id="iq2" placeholder="2-й кач-во" type="number" min="0" step="0.01" style="width: 60px; background-color: white;">\n                <input id="ic2" placeholder="2-й кол-во" type="number" min="0" step="1"    style="width: 70px; background-color: white;">\n\n                <div style="display: flex;flex-direction: row;gap: 10px;grid-column: 1/4;">\n                    <div>до результата ещё надо</div>\n                    <div><b id="irq">--</b> / <span id="irc">--</span> =&gt; <b id="irqA">--</b></div>\n                </div>\n            </div>\n        </div>`;dv.innerHTML=html;(0,insertAfter_1.insertAfter)(dv,document.querySelector("form[name=purchaseForm]"));dv.querySelectorAll("input").forEach((nv=>{nv.addEventListener("change",(()=>reCalcQ(dv)))}));reCalcQ(dv)}};exports.onEquipmentPurchasePage=onEquipmentPurchasePage;const reCalcQ=async el=>{const defaultValues=!!sessionStorage.getItem("Calc")?JSON.parse(sessionStorage.getItem("Calc")):undefined;const r0=Number(el.querySelector("#qc").value.replace(/,/gi,".")??0);const rq=Number(el.querySelector("#ca").dataset.value??el.querySelector("#ca").value.replace(/,/gi,"."));const r1=[Number(el.querySelector("#sq").value.replace(/,/gi,".")),Number(el.querySelector("#sc").value)];const r2=[Number(el.querySelector("#iq1").value.replace(/,/gi,".")),Number(el.querySelector("#ic1").value)];const r3=[Number(el.querySelector("#iq2").value.replace(/,/gi,".")),Number(el.querySelector("#ic2").value)];if(!r0&&r0!==defaultValues[0]){el.querySelector("#qc").value=String(defaultValues[0]);return}if(!rq&&rq!==defaultValues[1]){el.querySelector("#ca").value=String(defaultValues[1]);return}if(!r1[0]&&r1[0]!==defaultValues[2][0]){el.querySelector("#sq").value=String(defaultValues[2][0]);el.querySelector("#sc").value=String(defaultValues[2][1]);return}if(!r2[0]&&r2[0]!==defaultValues[3][0]){el.querySelector("#iq1").value=String(defaultValues[3][0]);el.querySelector("#ic1").value=String(defaultValues[3][1]);return}if(!r3[0]&&r3[0]!==defaultValues[4][0]){el.querySelector("#iq2").value=String(defaultValues[4][0]);el.querySelector("#ic2").value=String(defaultValues[4][1]);return}el.querySelector("#isq").textContent=(0,formatNumber_1.formatNumber)(((r1[0]*r1[1]+r2[0]*r2[1]+r3[0]*r3[1])/(r1[1]+r2[1]+r3[1])).toFixed(2));el.querySelector("#isc").textContent=(0,formatNumber_1.formatNumber)(((rq*(r1[1]+r3[1])-r1[0]*r1[1]-r3[0]*r3[1])/(r2[0]-rq)).toFixed(2));let irc=r0-(r1[1]+r2[1]+r3[1])>0?r0-(r1[1]+r2[1]+r3[1]):0,irq=(rq*r0-r1[0]*r1[1]-r2[0]*r2[1]-r3[0]*r3[1])/irc;el.querySelector("#irq").textContent=isNaN(irq)?"--":irq>=0&&isFinite(irq)?(0,formatNumber_1.formatNumber)(irq.toFixed(2)):" такое не реально ";el.querySelector("#irc").textContent=irc>=0?String(irc):" хотите купить больше, чем возможно ";el.querySelector("#irqA").textContent=(isNaN((r1[0]*r1[1]+r2[0]*r2[1]+r3[0]*r3[1]+irc*(isNaN(irq)?0:irq))/(r1[1]+r2[1]+r3[1]+irc))?"--":(0,formatNumber_1.formatNumber)(((r1[0]*r1[1]+r2[0]*r2[1]+r3[0]*r3[1]+irc*(isNaN(irq)?0:irq))/(r1[1]+r2[1]+r3[1]+irc)).toFixed(2)))+" // "+(0,formatNumber_1.formatNumber)(((r1[0]*r1[1]+r2[0]*r2[1]+r3[0]*r3[1])/(r1[1]+r2[1]+r3[1])).toFixed(2));sessionStorage.setItem("Calc",JSON.stringify([r0,rq,r1,r2,r3]))}},477:function(__unused_webpack_module,exports,__webpack_require__){var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){if(k2===undefined)k2=k;var desc=Object.getOwnPropertyDescriptor(m,k);if(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable)){desc={enumerable:true,get:function(){return m[k]}}}Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){if(k2===undefined)k2=k;o[k2]=m[k]});var __exportStar=this&&this.__exportStar||function(m,exports){for(var p in m)if(p!=="default"&&!Object.prototype.hasOwnProperty.call(exports,p))__createBinding(exports,m,p)};Object.defineProperty(exports,"__esModule",{value:true});__exportStar(__webpack_require__(994),exports)},146:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:true});exports.onFactoryPage=void 0;const getQbase_1=__webpack_require__(892);const addOptPriceInfo_1=__webpack_require__(244);const fillInfo_1=__webpack_require__(400);const onFactoryPage=async()=>{const sp=new URLSearchParams(document.location.search);const factoryId=Number(sp.get("id"));const tab=sp.get("tab")??"factory";switch(tab){case"factory":{break}case"divisions":{(0,fillInfo_1.fillInfo)();break}case"goods":{(0,addOptPriceInfo_1.addOptPriceInfo)();(0,getQbase_1.loadQBase)(factoryId);break}}};exports.onFactoryPage=onFactoryPage},371:function(__unused_webpack_module,exports,__webpack_require__){var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){if(k2===undefined)k2=k;var desc=Object.getOwnPropertyDescriptor(m,k);if(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable)){desc={enumerable:true,get:function(){return m[k]}}}Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){if(k2===undefined)k2=k;o[k2]=m[k]});var __exportStar=this&&this.__exportStar||function(m,exports){for(var p in m)if(p!=="default"&&!Object.prototype.hasOwnProperty.call(exports,p))__createBinding(exports,m,p)};Object.defineProperty(exports,"__esModule",{value:true});__exportStar(__webpack_require__(146),exports)},244:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:true});exports.addOptPriceInfo=void 0;const getMyCompany_1=__webpack_require__(591);const addOptSellInfo_1=__webpack_require__(35);const addOptPriceInfo=async()=>{const sp=new URLSearchParams(document.location.search);const factoryId=Number(sp.get("id"));const productId=Number(sp.get("product"));const tab=sp.get("tab")??"goods";const stab=sp.get("stab")??"sales";const sort=sp.get("srt")??"";const parentElement=document.querySelector("div#content div.tabbodyie form");if(!productId||!factoryId||!parentElement||stab!=="sales"){return}const{cityId}=await(0,getMyCompany_1.getMyCompany)();const CurrQ=parseFloat(document.querySelector("#boxright > div.tabbody > div > form > table > tbody > tr:nth-child(1) > td > table > tbody > tr:nth-child(2) > td:nth-child(2)")?.textContent??"0");const CityOffer=!!sort;const priceCtrlEl=document.querySelector("#price_ctrl");const priceValue=parseFloat(priceCtrlEl?.value?.replace(/\s+|p/gi,"")??"0");const newB=document.createElement("b");newB.textContent=String(Math.round(priceValue/CurrQ*100)/100);document.querySelector("#boxright > div.tabbody > div > form > table > tbody > tr:nth-child(1) > td > table > tbody > tr:nth-child(4) > td:nth-child(1)")?.appendChild(newB);const linkQualitySort=new URLSearchParams({id:String(factoryId),tab,stab,product:String(productId)});const linkPriceSort=new URLSearchParams(linkQualitySort);linkPriceSort.append("srt","total_cost");const AddLine=[`<a href="?${linkQualitySort}">Q</a>`,`<a href="?${linkPriceSort}">Price</a><br>`].join(" | ");await(0,addOptSellInfo_1.addOptSellInfo)({productId,idShop:factoryId,city:cityId,CityOffer,sort,CurrQ},(div=>{parentElement.after(div)}),AddLine)};exports.addOptPriceInfo=addOptPriceInfo},400:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:true});exports.fillInfo=void 0;const saveInfo_1=__webpack_require__(986);const fillInfo=async()=>{const sp=new URLSearchParams(document.location.search);const divisionId=Number(sp.get("division"));if(!divisionId){return}const Elinfo=document.querySelector("#boxright");if(!Elinfo){return}(0,saveInfo_1.saveInfo)({Elinfo,QEmpSel:"form > div > table.datatable > tbody > tr:nth-child(2) > td:nth-child(6)",CurrEqSel:"form > div > table.datatable > tbody > tr:nth-child(4) > td:nth-child(4)",MaxEqSel:"form > div > table.datatable > tbody > tr:nth-child(4) > td:nth-child(5)",QEqSel:"form > div > table.datatable > tbody > tr:nth-child(4) > td:nth-child(7)",QNeedSel:"form > div > table.datatable > tbody > tr:nth-child(4) > td:nth-child(9)"})};exports.fillInfo=fillInfo},468:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:true});exports.onFishfarmPage=void 0;const qualityInput_1=__webpack_require__(304);const onFishfarmPage=async()=>{const sp=new URLSearchParams(document.location.search);const fishfarmId=Number(sp.get("id"));const tab=sp.get("tab")??"fishfarm";switch(tab){case"fishfarm":{break}case"goods":{(0,qualityInput_1.upgradeQualityInput)();break}}};exports.onFishfarmPage=onFishfarmPage},901:function(__unused_webpack_module,exports,__webpack_require__){var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){if(k2===undefined)k2=k;var desc=Object.getOwnPropertyDescriptor(m,k);if(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable)){desc={enumerable:true,get:function(){return m[k]}}}Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){if(k2===undefined)k2=k;o[k2]=m[k]});var __exportStar=this&&this.__exportStar||function(m,exports){for(var p in m)if(p!=="default"&&!Object.prototype.hasOwnProperty.call(exports,p))__createBinding(exports,m,p)};Object.defineProperty(exports,"__esModule",{value:true});__exportStar(__webpack_require__(468),exports)},826:function(__unused_webpack_module,exports,__webpack_require__){var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){if(k2===undefined)k2=k;var desc=Object.getOwnPropertyDescriptor(m,k);if(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable)){desc={enumerable:true,get:function(){return m[k]}}}Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){if(k2===undefined)k2=k;o[k2]=m[k]});var __exportStar=this&&this.__exportStar||function(m,exports){for(var p in m)if(p!=="default"&&!Object.prototype.hasOwnProperty.call(exports,p))__createBinding(exports,m,p)};Object.defineProperty(exports,"__esModule",{value:true});__exportStar(__webpack_require__(739),exports);__exportStar(__webpack_require__(574),exports);__exportStar(__webpack_require__(477),exports);__exportStar(__webpack_require__(371),exports);__exportStar(__webpack_require__(901),exports);__exportStar(__webpack_require__(336),exports);__exportStar(__webpack_require__(510),exports);__exportStar(__webpack_require__(791),exports);__exportStar(__webpack_require__(582),exports);__exportStar(__webpack_require__(954),exports);__exportStar(__webpack_require__(565),exports)},336:function(__unused_webpack_module,exports,__webpack_require__){var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){if(k2===undefined)k2=k;var desc=Object.getOwnPropertyDescriptor(m,k);if(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable)){desc={enumerable:true,get:function(){return m[k]}}}Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){if(k2===undefined)k2=k;o[k2]=m[k]});var __exportStar=this&&this.__exportStar||function(m,exports){for(var p in m)if(p!=="default"&&!Object.prototype.hasOwnProperty.call(exports,p))__createBinding(exports,m,p)};Object.defineProperty(exports,"__esModule",{value:true});__exportStar(__webpack_require__(602),exports)},602:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:true});exports.onMinePage=void 0;const qualityInput_1=__webpack_require__(304);const addOptPriceInfo_1=__webpack_require__(349);const onMinePage=async()=>{const sp=new URLSearchParams(document.location.search);const mineId=Number(sp.get("id"));const tab=sp.get("tab")??"mine";switch(tab){case"mine":{break}case"goods":{(0,qualityInput_1.upgradeQualityInput)();(0,addOptPriceInfo_1.addOptPriceInfo)();break}}};exports.onMinePage=onMinePage},349:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:true});exports.addOptPriceInfo=void 0;const getMyCompany_1=__webpack_require__(591);const addOptSellInfo_1=__webpack_require__(35);const addOptPriceInfo=async()=>{const sp=new URLSearchParams(document.location.search);const productId=Number(sp.get("product"));const mineId=Number(sp.get("id"));const parentElement=document.querySelector("div#content div.tabbodyie form");if(!productId||!mineId||!parentElement){return}const{cityId}=await(0,getMyCompany_1.getMyCompany)();const CurrQ=parseFloat(document.querySelector("#boxright > div.tabbody > div > form > table > tbody > tr:nth-child(1) > td > table > tbody > tr:nth-child(2) > td:nth-child(2)")?.textContent??"0");const CityOffer=true;const priceCtrlEl=document.querySelector("#price_ctrl");const priceValue=parseFloat(priceCtrlEl?.value?.replace(/\s+|p/gi,"")??"0");const newB=document.createElement("b");newB.textContent=String(Math.round(priceValue/CurrQ*100)/100);document.querySelector("#boxright > div.tabbody > div > form > table > tbody > tr:nth-child(1) > td > table > tbody > tr:nth-child(4) > td:nth-child(1)")?.appendChild(newB);await(0,addOptSellInfo_1.addOptSellInfo)({productId,idShop:mineId,city:cityId,CityOffer,sort:"",CurrQ},(div=>{parentElement.after(div)}))};exports.addOptPriceInfo=addOptPriceInfo},510:function(__unused_webpack_module,exports,__webpack_require__){var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){if(k2===undefined)k2=k;var desc=Object.getOwnPropertyDescriptor(m,k);if(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable)){desc={enumerable:true,get:function(){return m[k]}}}Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){if(k2===undefined)k2=k;o[k2]=m[k]});var __exportStar=this&&this.__exportStar||function(m,exports){for(var p in m)if(p!=="default"&&!Object.prototype.hasOwnProperty.call(exports,p))__createBinding(exports,m,p)};Object.defineProperty(exports,"__esModule",{value:true});__exportStar(__webpack_require__(642),exports)},642:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:true});exports.onSawmillPage=void 0;const qualityInput_1=__webpack_require__(304);const onSawmillPage=async()=>{const sp=new URLSearchParams(document.location.search);const sawmillId=Number(sp.get("id"));const tab=sp.get("tab")??"sawmill";switch(tab){case"sawmill":{break}case"goods":{(0,qualityInput_1.upgradeQualityInput)();break}}};exports.onSawmillPage=onSawmillPage},791:function(__unused_webpack_module,exports,__webpack_require__){var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){if(k2===undefined)k2=k;var desc=Object.getOwnPropertyDescriptor(m,k);if(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable)){desc={enumerable:true,get:function(){return m[k]}}}Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){if(k2===undefined)k2=k;o[k2]=m[k]});var __exportStar=this&&this.__exportStar||function(m,exports){for(var p in m)if(p!=="default"&&!Object.prototype.hasOwnProperty.call(exports,p))__createBinding(exports,m,p)};Object.defineProperty(exports,"__esModule",{value:true});__exportStar(__webpack_require__(780),exports)},780:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:true});exports.onShopPage=void 0;const markUniqGoods_1=__webpack_require__(499);const showGoodsProfit_1=__webpack_require__(682);const onShopPage=async()=>{const sp=new URLSearchParams(document.location.search);const shopId=Number(sp.get("id"));const tab=sp.get("tab")??"shop";switch(tab){case"shop":{break}case"goods":{(0,showGoodsProfit_1.showGoodsProfit)();break}case"divisions":{(0,markUniqGoods_1.markUniqGoods)();break}}};exports.onShopPage=onShopPage},499:(__unused_webpack_module,exports)=>{Object.defineProperty(exports,"__esModule",{value:true});exports.markUniqGoods=void 0;const markUniqGoods=()=>{const imageEls=document.querySelectorAll("#content > div.pad12 > form > table.goods > tbody > tr > td.int.hidecompact > a > img");const stI={};imageEls.forEach((({src})=>{stI[src]=1+(stI[src]??0)}));imageEls.forEach((image=>{if(stI[image.src]==1){image.border="2"}}))};exports.markUniqGoods=markUniqGoods},682:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:true});exports.showGoodsProfit=void 0;const getStoreGoods_1=__webpack_require__(153);const addWikiLink_1=__webpack_require__(28);const showGoodsProfit=()=>{(0,getStoreGoods_1.getStoreGoods)().forEach((item=>{const[,titleCell]=item.cells;(0,addWikiLink_1.addWikiLink)(item.title,titleCell);showCityBasedDeviation(item);switch(item.type){case getStoreGoods_1.StoreGoodsType.Closed:{break}case getStoreGoods_1.StoreGoodsType.Opened:{break}}}))};exports.showGoodsProfit=showGoodsProfit;const showCityBasedDeviation=goods=>{const{quality,price,cityQuality,cityPrice}=goods;const priceValue=goods.type===getStoreGoods_1.StoreGoodsType.Opened?goods.sellPrice.value:price.value;const priceQuality=priceValue/quality.value;const cityPriceQuality=cityPrice.value/cityQuality.value;const ratio=priceQuality/cityPriceQuality;const deviation=(ratio-1)*100;if(isNaN(deviation)||!isFinite(deviation)||deviation===0){return}const recTxt=document.createElement("span");recTxt.textContent=`${deviation>0?"+":""}${deviation.toFixed(2)} %`;recTxt.title="Отклонение от Средней в городе (с учетом качества)";recTxt.style.backgroundColor=deviation<0?"lightpink":deviation>0?"lightgreen":"";price.cell.appendChild(recTxt)}},954:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:true});exports.onVendorSelectPage=void 0;const vendorsTable_1=__webpack_require__(254);const onVendorSelectPage=async()=>{(0,vendorsTable_1.upgradeVendorsTable)()};exports.onVendorSelectPage=onVendorSelectPage},582:function(__unused_webpack_module,exports,__webpack_require__){var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){if(k2===undefined)k2=k;var desc=Object.getOwnPropertyDescriptor(m,k);if(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable)){desc={enumerable:true,get:function(){return m[k]}}}Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){if(k2===undefined)k2=k;o[k2]=m[k]});var __exportStar=this&&this.__exportStar||function(m,exports){for(var p in m)if(p!=="default"&&!Object.prototype.hasOwnProperty.call(exports,p))__createBinding(exports,m,p)};Object.defineProperty(exports,"__esModule",{value:true});__exportStar(__webpack_require__(634),exports)},187:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:true});exports.addOptPriceInfo=void 0;const getMyCompany_1=__webpack_require__(591);const addOptSellInfo_1=__webpack_require__(35);const addOptPriceInfo=async()=>{const sp=new URLSearchParams(document.location.search);const productId=Number(sp.get("product"));const warehouseId=Number(sp.get("id"));const parentElement=document.querySelector("div#content div.tabbodyie form");if(!productId||!warehouseId||!parentElement){return}const{cityId}=await(0,getMyCompany_1.getMyCompany)();const CurrQ=parseFloat(document.querySelector("#boxright > div.tabbody > div > form > table > tbody > tr:nth-child(1) > td > table > tbody > tr:nth-child(2) > td:nth-child(2)")?.textContent??"0");const CityOffer=true;const priceCtrlEl=document.querySelector("#price_ctrl");const priceValue=parseFloat(priceCtrlEl?.value?.replace(/\s+|p/gi,"")??"0");const newB=document.createElement("b");newB.textContent=String(Math.round(priceValue/CurrQ*100)/100);document.querySelector("#boxright > div.tabbody > div > form > table > tbody > tr:nth-child(1) > td > table > tbody > tr:nth-child(4) > td:nth-child(1)")?.appendChild(newB);await(0,addOptSellInfo_1.addOptSellInfo)({productId,idShop:warehouseId,city:cityId,CityOffer,sort:"",CurrQ},(div=>{parentElement.after(div)}))};exports.addOptPriceInfo=addOptPriceInfo},634:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:true});exports.onWarehousePage=void 0;const addOptPriceInfo_1=__webpack_require__(187);const onWarehousePage=async()=>{const sp=new URLSearchParams(document.location.search);const warehouseId=Number(sp.get("id"));const tab=sp.get("tab")??"warehouse";switch(tab){case"warehouse":{break}case"goods":{(0,addOptPriceInfo_1.addOptPriceInfo)();break}case"supply":{break}}};exports.onWarehousePage=onWarehousePage},565:(__unused_webpack_module,exports)=>{Object.defineProperty(exports,"__esModule",{value:true});exports.onWeeklyPacksPage=void 0;const onWeeklyPacksPage=async()=>{const qualificationEl=document.querySelectorAll("#content > div.tabbody > div > form > table > tbody > tr > td > div > table > tbody > tr:nth-child(3) > td > b");const priceEl=document.querySelectorAll("#content > div.tabbody > div > form > table > tbody > tr > td > div > table > tbody > tr:nth-child(4) > td > div > a > span");[...priceEl].forEach((function(i,ind){const points=Number(qualificationEl[ind].textContent);const price=parseFloat(i.textContent?.replace(/[^\d]/g,"")??"0");const pointsPrice=Math.round(price*100/points)/100;const suffix=i.textContent?.replace(/\d/g,"")??"";qualificationEl[ind].textContent+=` (${pointsPrice}${suffix})`}))};exports.onWeeklyPacksPage=onWeeklyPacksPage},591:(__unused_webpack_module,exports)=>{Object.defineProperty(exports,"__esModule",{value:true});exports.getMyCompany=void 0;const getMyCompany=async()=>{const mainScript=document.querySelectorAll("#divmenu.menucontainer script")[1]?.textContent??"";const companyId=parseInt(mainScript.match(/company\?id=(\d+)/)?.[1]??"0")??0;const citySrc=document.querySelector("table.unith tbody")?.rows?.[1]?.cells?.[4]?.querySelectorAll("a")?.[1]?.href?.split("=")?.[1]??"0";const cityId=parseInt(citySrc)??0;return{companyId,cityId}};exports.getMyCompany=getMyCompany},117:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:true});exports.getOptVendors=exports.getOptPriceQuality=void 0;const loader_1=__webpack_require__(584);const getMyCompany_1=__webpack_require__(591);const getOptPriceQuality=async args=>{const doc=await getOptDoc(args);if(!doc){return}const R=doc.querySelector("td#boxright.boxright table.datatable tbody");if(!R||R.rows[0].cells[0].classList.contains("tblempty")){return}const{companyId}=await(0,getMyCompany_1.getMyCompany)();const firstNotMyRow=[...R.rows].find((row=>{const hrf=row.cells[2].querySelector("a");const sP=hrf?parseInt(hrf.href.split("=").slice(-1)[0]):-1;return sP!==companyId}));if(!firstNotMyRow){return}const qualityCell=firstNotMyRow.cells[6];const quality=parseFloat(qualityCell.innerText.replace(/\s+|p/gi,""));const priceCell=firstNotMyRow.cells[11];const price=parseFloat(priceCell.innerText.replace(/\s+|p/gi,""));return price/quality};exports.getOptPriceQuality=getOptPriceQuality;const getOptVendors=async args=>{const doc=await getOptDoc(args);if(!doc){return[]}const tbodyEl=doc.querySelector("td#boxright.boxright table.datatable tbody");if(!tbodyEl||!tbodyEl.rows[0].cells.length){return[]}const{companyId}=await(0,getMyCompany_1.getMyCompany)();const returnValue=[...tbodyEl.rows].map((({cells})=>{const nmCell=cells[2];const nm=nmCell.innerText;const linkSp=nmCell.querySelector("a");const sP=linkSp?parseInt(linkSp.href.split("=").slice(-1)[0]):0;const linkSpv=cells[1].querySelector("a");const sPv=linkSpv?parseInt(linkSpv.href.split("=").slice(-1)[0]):0;const addr=cells[4].innerText;const stock=parseFloat(cells[5].innerText.replace(/\s+/gi,""));const quality=parseFloat(cells[6].innerText.replace(/\s+/gi,""));const days=parseFloat(cells[9].innerText.replace(/[^\d]/gi,""));const deliver=parseFloat(cells[8].innerText.replace(/\s+|p/gi,""));const customs=parseFloat(cells[10].innerText.replace(/\s+|p/gi,""));const price=parseFloat(cells[11].innerText.replace(/\s+|p/gi,""));return{isMine:sP==companyId,companyTitle:nm,cityTitle:addr,amount:stock,totalPrice:price,quality,priceQuality:price/quality,buildingId:sPv,deliveryDays:days-(deliver==0?1:0),deliveryPrice:deliver,customs}}));if(!args.allPages){return returnValue}const scriptText=doc.querySelector(".tblpages > script")?.text??"";const mPage=parseInt(/createPGNavigator\("vendors","vendorsfrm","p",1,(\d+),/g.exec(scriptText)?.[1]??"1");if(mPage===1){return returnValue}const promises=[];for(let p=2;p<=mPage;p++){promises.push((0,exports.getOptVendors)({...args,page:p,allPages:false}))}const pages=await Promise.all(promises);return returnValue.concat(...pages.flat())};exports.getOptVendors=getOptVendors;const getOptDoc=async({productId:id,cityId:city,cityOffer:CityOffer,sortOrder,page=1})=>{const url=`https://bizmania.ru/analitics/vendors/?product=${id}&type=vendor&city=${city}`+(sortOrder!==""?`&sort=${sortOrder}`:"")+(page!=1?`&p=${page}`:"")+(CityOffer?"&cityOffersOnly=on":"");return(0,loader_1.getHtml)(url)}},892:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:true});exports.loadQBase=exports.getQBase=void 0;const loader_1=__webpack_require__(584);const getQBase=factoryId=>{const data=sessionStorage.getItem(`P${factoryId}d`);if(data){return JSON.parse(data)}return(0,exports.loadQBase)(factoryId)};exports.getQBase=getQBase;const loadQBase=async(factoryId,download=false)=>{const dlp=document.location.pathname;const searchParams=new URLSearchParams(document.location.search);const isLocal="/units/factory/"===dlp&&searchParams.get("tab")==="goods"&&!searchParams.get("product");if(!isLocal&&!download){return}const s1=isLocal?document:await(0,loader_1.getHtml)(`https://bizmania.ru/units/factory/?id=${factoryId}&tab=goods`);if(!s1){return}const shemes={};const goods={};const urls=["https://bizmania.ru/img/sprite/","https://bizmania.ru/img/products/"];const divisionRows=[...s1.querySelectorAll("#produce > tbody > tr")];const divisions=divisionRows.map((el=>({img:el.cells[0]?.querySelector("img")?.src.split("/").pop()??"",title:el.cells[1]?.querySelector("a")?.textContent??"",divisionId:Number(el.cells[11]?.querySelector("a")?.href.match(/id=(\d+)/)?.[1])})));const fractionToNumber=v=>{const vv=v.split("/");return vv&&vv.length==2?parseFloat(vv[0])/parseFloat(vv[1]):parseFloat(v)};const promises=divisions.map((async({divisionId})=>{const schemeDialogFrame=await(0,loader_1.getHtml)(`https://bizmania.ru/units/produce/scheme/?id=${divisionId}`);if(!schemeDialogFrame){return}const schemeRows=[...schemeDialogFrame.querySelectorAll("form[name=schemeForm] > table.datatable > tbody > tr")];shemes[divisionId]=schemeRows.map((({cells})=>{const[imageCell,titleCell,produceCell,consumeCell,sourceCell]=cells;const image=imageCell.querySelector("img")?.src??"";const title=titleCell.textContent??"";const produce=parseFloat(produceCell?.textContent??"0");const consume=parseFloat(consumeCell?.textContent??"0");goods[title]=image.split("/").pop()??"";const sources=[];const dc=sourceCell.querySelectorAll("table tr")[0].cells;for(let i=0;i<dc.length;i=i+2){const sourceProductCell=dc[i];const sourceAmountCell=dc[i+1];const sourceProductImage=sourceProductCell.querySelector("img");const sourceTitle=sourceProductImage?.title??"";goods[sourceTitle]=sourceProductImage?.src.split("/").pop()??"";sources.push({title:sourceTitle,qualityPart:parseInt(sourceProductCell.textContent?.replace(/%/gi,"")??"0"),amount:fractionToNumber(sourceAmountCell.textContent?.replace(/x /gi,"")??"0")})}return{title,produce,consume,sources}}))}));await Promise.all(promises);const value={data:shemes,goods,prod:divisions,urls};sessionStorage.setItem(`P${factoryId}d`,JSON.stringify(value));return value};exports.loadQBase=loadQBase},153:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:true});exports.getStoreGoods=exports.StoreGoodsType=void 0;const filters_1=__webpack_require__(680);var StoreGoodsType;(function(StoreGoodsType){StoreGoodsType["Closed"]="Closed";StoreGoodsType["Opened"]="Opened";StoreGoodsType["Mine"]="Mine"})(StoreGoodsType||(exports.StoreGoodsType=StoreGoodsType={}));const getStoreGoods=()=>[...document.querySelectorAll("#goods tr[id^=pr]")].map((tr=>({id:Number(tr.getAttribute("id")?.replace(/pr/g,"")),row:tr,cells:[...tr.querySelectorAll("td")]}))).map((({id,row,cells})=>{if(!id||id<=0||isNaN(id)){return}const[imageCell]=cells;const imageEl=imageCell.querySelector("img");const icon=imageEl?.src??"";const name=icon.split("/").pop()?.split(".gif")[0]??"";const title=imageEl?.title??"";const base={id,name,title,icon,row,cells};switch(cells.length){case 6:{const plainNumberCells=[2,3,4,5];const[quality,price,cityQuality,cityPrice]=plainNumberCells.map((i=>({value:parseFloat(cells[i]?.textContent?.replace(/(p\.|\s)+/g,"")??""),cell:cells[i]})));return{...base,type:StoreGoodsType.Closed,quality,price,cityQuality,cityPrice}}case 16:{const plainNumberCells=[5,6,7,10,11,12];const[amount,quality,price,cityQuality,cityPrice,sellAmount]=plainNumberCells.map((i=>({value:parseFloat(cells[i]?.textContent?.replace(/(p\.|\s)+/g,"")??""),cell:cells[i]})));const inputNumberCells=[9,14];const isMine=!!cells[inputNumberCells[0]]?.querySelector("input.edit");const[sellPrice,buyAmount]=inputNumberCells.map((i=>({value:parseFloat((isMine?cells[i]?.querySelector("input.edit")?.value:cells[i]?.textContent)?.replace(/(p\.|\s)+/g,"")??""),cell:cells[i]})));return{...base,type:StoreGoodsType.Opened,amount,quality,price,sellPrice,cityQuality,cityPrice,sellAmount,buyAmount}}default:return}})).filter(filters_1.notUndefined);exports.getStoreGoods=getStoreGoods},179:(__unused_webpack_module,exports)=>{Object.defineProperty(exports,"__esModule",{value:true});exports.loadInfo=void 0;const loadInfo=async divisionId=>{const sp=new URLSearchParams(document.location.search);const division=divisionId??Number(sp.get("division"));if(!division){return}const info=sessionStorage.getItem(`E${division}_pinfo`);if(!info){return}return JSON.parse(info)};exports.loadInfo=loadInfo},986:(__unused_webpack_module,exports)=>{Object.defineProperty(exports,"__esModule",{value:true});exports.saveInfo=void 0;const saveInfo=async({Elinfo,QEmpSel,CurrEqSel,MaxEqSel,QEqSel,QNeedSel})=>{const sp=new URLSearchParams(document.location.search);const division=Number(sp.get("division"));if(!division){return}const info={QEmp:parseFloat(Elinfo.querySelector(QEmpSel)?.textContent??"0"),CurrEq:parseInt(Elinfo.querySelector(CurrEqSel)?.textContent?.replace(/\s/g,"")??"0"),MaxEq:parseInt(Elinfo.querySelector(MaxEqSel)?.textContent?.replace(/\s/g,"")??"0"),QEq:parseFloat(Elinfo.querySelector(QEqSel)?.textContent??"0"),QNeed:QNeedSel?parseFloat(Elinfo.querySelector(QNeedSel)?.textContent??"0"):0};sessionStorage.setItem(`E${division}_pinfo`,JSON.stringify(info))};exports.saveInfo=saveInfo},35:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:true});exports.addOptSellInfo=void 0;const getOptPrices_1=__webpack_require__(117);const formatNumber_1=__webpack_require__(897);const addOptSellInfo=async({productId,idShop,city,CityOffer,sort,CurrQ,addHead},mount,AddLine="")=>{const html=await getOptSellHtml({productId,idShop,CurrVendor:-1,arDParam:{city,CityOffer,important:false,sort},CityQ:0,CurrQ,hideSet:true,addHead,styles:"max-width: 100%;",setQ:true});const newElement=document.createElement("div");newElement.style.setProperty("float","left");newElement.innerHTML=AddLine+html;mount(newElement)};exports.addOptSellInfo=addOptSellInfo;const getOptSellHtml=async({productId,idShop,CurrVendor,arDParam,CityQ,CurrQ,hideSet,addHead="",styles="max-width: 550px; width:100%",setQ=false})=>{const vendors=await(0,getOptPrices_1.getOptVendors)({productId,cityId:arDParam.city,cityOffer:typeof arDParam.CityOffer!=="undefined"?arDParam.CityOffer:false,important:typeof arDParam.important!=="undefined"?arDParam.important:false,sortOrder:typeof arDParam.sort!=="undefined"?arDParam.sort:""});const arDString=vendors.reduce(((acc,vendor,ind)=>{const{amount,buildingId,cityTitle,companyTitle,customs,deliveryDays,deliveryPrice,isMine,priceQuality,quality,totalPrice}=vendor;const companyStyle=buildingId==CurrVendor?"background-color: rgb(198, 236, 255);":"";const companyValue=isMine?"<b>"+companyTitle+"</b>":companyTitle;const newPrice=CurrQ*priceQuality;const priceStyle=CityQ>0&&CityQ<priceQuality?"background-color: lightpink; text-decoration: line-through;":"";return acc+`<tr class="tbl${ind%2?"g":""}r">`+`   <td style="${companyStyle}">${companyValue}</td>`+`   <td title="${deliveryPrice} + ${customs}">${cityTitle}${deliveryDays>0?"&nbsp;<b> &#"+(9311+deliveryDays)+";</b>":""}</td>`+`   <td align=right><nobr>${(0,formatNumber_1.formatNumber)(amount.toFixed(0))}</nobr></td>`+`   <td align=center>${quality}</td>`+`   <td align=right><nobr>${(0,formatNumber_1.formatMoney)(totalPrice.toFixed(totalPrice>100?0:2))}</nobr></td>`+`   <td align=center style="${priceStyle}">`+(setQ?`<a href=# onclick="document.querySelector('#price_ctrl').value='${newPrice.toFixed(newPrice>100?0:2)}'; document.getElementById('submit').style.display='inline'; return false;">${(0,formatNumber_1.formatMoney)(priceQuality.toFixed(priceQuality>100?0:2))}</a>`:(0,formatNumber_1.formatMoney)(priceQuality.toFixed(priceQuality>100?0:2)))+`</td>`+(addHead?"<td data-id="+buildingId+(priceQuality<CurrQ||isNaN(CurrQ)?' style="background-color: lightgreen;"':"")+"><nobr>"+(hideSet?"":'<button data-type=set class=AddToStockGoods onclick="return false;">&#128722;</button> ')+'<input type=number value=0 class=smA style="width:70px"><button data-type=buy class=AddToStockGoods onclick="return false;">&#10009;</button></nobr></td>':"")+`</tr>`}),"");return`<table data-idProd=${productId} data-idShop=${idShop} data-CurrVendor=${CurrVendor} class="datatable" cellpadding="5" cellspacing="0" border="0" style="${styles}">`+`   <thead><tr class="tblhr">`+`       <td class="tblh1">Компания</td>`+`       <td class="tblh">Город</td>`+`       <td class="tblh">Объем</td>`+`       <td class="tblh">Качество</td>`+`       <td class="tblh">Цена</td>`+`       <td class="tblh">за качество</td>${addHead}`+`   </tr></thead>`+`   <tbody>${arDString}</tbody>`+`</table>`}},28:(__unused_webpack_module,exports)=>{Object.defineProperty(exports,"__esModule",{value:true});exports.addWikiLink=void 0;const addWikiLink=(txt,el)=>{const product=productTitleToName[txt];if(!product){return}const wl=document.createElement("a");wl.target="_blank";wl.href=`/wikihelp/?topic=Справочник+продуктов&product=${product}`;wl.innerHTML="(&#8505;)";el.appendChild(document.createTextNode(" "));el.appendChild(wl)};exports.addWikiLink=addWikiLink;const productTitleToName={Автомобиль:"car",Аккумулятор:"battery",Аксессуары:"accessories",Домкрат:"jack",Квадроцикл:"quadbike",Компрессор:"compressor","Кузовные детали":"bodyparts","Машинное масло":"machineoil",Мотоблок:"motoblock",Мотоцикл:"moto","Омывающая жидкость":"washerfluid",Сабвуфер:"subwoofer",Скутер:"scooter",Шины:"tire",Электромобиль:"electriccar",Борщ:"borsch",Винегрет:"venigret",Гамбургер:"hamburger",Глинтвейн:"mulledwine","Жареная рыба":"friedfish",Запеканка:"casserol","Итальянское ассорти":"italianassorted","Молочный коктейль":"milkshake","Мясо по-французски":"frenchmeat","Пивной сет":"beerset",Пицца:"pizza",Плов:"pilaf","Ребрышки по-фламандски":"flemishribs","Салат Греческий":"saladgreece","Салат Столичный":"saladcapital","Сельдь под шубой":"saladherring",Сидр:"cider",Солянка:"saltwort",Шаурма:"shawarma",Штрудель:"strudel",Коровы:"cows",Куры:"hens",Овцы:"sheeps",Свиньи:"pigs",Соболь:"sable",Двигатель:"engine",Дисплей:"display",Комплектующие:"parts",Провода:"wires","Электронные компоненты":"chips",Алюминий:"aluminium",Ароматизатор:"aromatisator",Бумага:"paper","Дизельное топливо":"dieselfuel",Кислота:"acid",Кожа:"leather",Кремний:"silicon",Медь:"copper",Пластик:"plastic",Реактивы:"reagent",Резина:"rubber",Синтетика:"synthetics",Спирт:"spirits",Сталь:"steel",Стекло:"glass",Ткань:"fabric",Удобрения:"fertilizer",Шерсть:"wool",Блузка:"blouse","Детская обувь":"childshoes","Детская одежда":"childclothes",Джинсы:"jeans","Женская обувь":"womanshoes",Костюм:"suit",Куртка:"jacket","Мужская обувь":"manshoes",Носки:"socks",Пальто:"mancoat",Перчатки:"gloves",Платье:"dress",Ремень:"belt",Рубашка:"shirt","Спортивная обувь":"sportshoes","Спортивная одежда":"sportclothes",Сумка:"bag",Футболка:"tshirt",Шапка:"cap",Шуба:"furcoat",Бокситы:"bauxite",Глина:"clay",Древесина:"wood","Железная руда":"ironore",Золото:"gold","Медная руда":"copperore",Минералы:"minerals",Нефть:"oil",Песок:"sand",Уголь:"coal",Белье:"underwear",Бижутерия:"bijouterie",Бритва:"razor","Золотые часы":"watches",Колготки:"tights",Косметика:"makeup",Парфюмерия:"parfume","Солнечные очки":"sunglasses",Сувенир:"souvenir",Фен:"hairdryer",Цветы:"flowers",Эпилятор:"epilator","Ювелирные украшения":"jewelry",Вино:"wine",Йогурт:"yogurt",Колбаса:"sausages","Крепкий алкоголь":"vodka",Крупа:"croup","Макаронные изделия":"macaron",Масло:"butter",Мука:"flour",Печенье:"cookies",Пиво:"beer","Прохладительные напитки":"gaswater","Растительное масло":"fat",Сахар:"sugar",Сок:"juice",Сыр:"cheese",Торт:"cake",Хлеб:"bread",Шоколад:"chocolate",Автопогрузчик:"autoloader",Ветрогенератор:"windgenerator","Горное оборудование":"mineequipment",Грузовик:"truck",Кран:"crane",Прибор:"device","Производственная линия":"machineline",Станки:"machine",Трактор:"tractor","Тяжелое оборудование":"heavyeq",Виноград:"grape",Зерно:"grain",Какао:"cacao",Картофель:"potato",Корм:"feed",Мех:"fur",Молоко:"milk",Мясо:"meat",Овощи:"vegetables",Рыба:"fish",Свекла:"beet","Тропические фрукты":"fruits",Яблоки:"apples",Яйца:"eggs",Велосипед:"bicycle",Гантели:"dumbbells",Коврик:"rug","Компрессионная одежда":"compression",Коньки:"skates",Лыжи:"skiing",Мяч:"ball","Надувной матрас":"mattress",Палатка:"tent",Ракетки:"rackets","Резиновая лодка":"rubberboat","Роликовые коньки":"roller",Рюкзак:"backpack",Самокат:"kickscooter","Спальный мешок":"sleeping",Термос:"thermos",Топор:"axe",Тренажер:"training",Фонарь:"flashlight",Шлем:"helmet",Инструменты:"tools","Бетонный блок":"concrete",Дверь:"door","Керамическая плитка":"tile",Кирпич:"brick",Клей:"glue",Краска:"paint",Крепеж:"fasteners","Напольные покрытия":"floor",Обогреватель:"heater",Обои:"wallpaper",Окна:"window",Сантехника:"sanitary",Светильник:"lamp",Трубы:"pipes",Цемент:"cement",Шторы:"curtains",Зонт:"umbrella","Зубная паста":"toothpaste",Игрушки:"toys",Конструктор:"constructor",Кресло:"chair",Кровать:"bed","Кухонный гарнитур":"kitchen","Моющее средство":"detergent",Мыло:"soap","Мягкая мебель":"sofa","Постельные принадлежности":"beddress",Посуда:"dishes",Пылесос:"cleaner",Сковорода:"pan","Стиральный порошок":"soappowder",Стол:"table",Стул:"stool",Чайник:"teapot",Шкаф:"wardrobe",Антибиотики:"antibiotics",Антисептик:"antiseptic",БАД:"supplements",Вакцина:"vaccine",Витамины:"vitamins","Детская смесь":"babyfood",Контрацептивы:"contraceptives","Лекарственные травы":"herbs","Лечебный крем":"healingcream","Мед техника":"medtechnic","Микроорганическая культура":"microculture",Настойка:"tincture","Ортопедические изделия":"orthopedic","Перевязочные средства":"bandage",Противопростудные:"cough","Рецептурные препараты":"prescription","Травяной сбор":"herbal","Фармацевтическая субстанция":"substance",Аудиотехника:"audio","Варочная панель":"hob",Вытяжка:"hood","Игровая приставка":"xbox",Кондиционер:"conditioning","Кухонный комбайн":"foodprocessor",Микроволновка:"microwave","Мобильный телефон":"mobile","Настольный компьютер":"desktop",Наушники:"headphones",Ноутбук:"notebook",Планшет:"tablet","Посудомоечная машина":"dishwasher",Принтер:"printer","Смарт часы":"smartwatch","Стиральная машина":"washer",Телевизор:"tv",Утюг:"iron",Фотоаппарат:"photo",Холодильник:"refrigirator"}},793:(__unused_webpack_module,exports)=>{Object.defineProperty(exports,"__esModule",{value:true});exports.upgradeMainMenu=void 0;const upgradeMainMenu=async myCompanyId=>{const LINKS=[{url:"/wikihelp/?topic=%D0%92%D0%B8%D0%B4%D1%8B+%D0%BF%D1%80%D0%B5%D0%B4%D0%BF%D1%80%D0%B8%D1%8F%D1%82%D0%B8%D0%B9&unit=shop.food",text:"Food wiki"},{url:`/company/?id=${myCompanyId}&tab=reports&section=accountlog&category=1&trantype=income`,text:"Income"},{url:`/company/?id=${myCompanyId}&tab=reports&section=accountlog&category=1&trantype=distribute+tender+redemption`,text:"Income Tender"}];const dm=document.querySelectorAll("div#divmenu div.smenu table tbody ")[4];if(!dm){return}LINKS.forEach((({url,text})=>{const linkRow=document.createElement("tr");const linkCell=document.createElement("td");const linkLink=document.createElement("a");linkLink.setAttribute("onclick","this.blur()");linkLink.className="smenulnk";linkCell.setAttribute("colspan","3");linkCell.setAttribute("nowrap","");linkRow.className="smenutd";linkLink.setAttribute("href",url);linkLink.text=` ${text} `;linkCell.appendChild(linkLink);linkRow.appendChild(linkCell);dm.appendChild(linkRow)}))};exports.upgradeMainMenu=upgradeMainMenu},304:(__unused_webpack_module,exports)=>{Object.defineProperty(exports,"__esModule",{value:true});exports.upgradeQualityInput=void 0;const upgradeQualityInput=()=>{const elements=document.querySelectorAll("#produce > tbody > tr > td:nth-child(13)  > div");[...elements].forEach((el=>{const inputEl=el.querySelector("input");if(!inputEl){return}const index=parseInt(inputEl.name.replace(/[^\d]/gi,""));const qualityCell=document.getElementById("dr_"+index);const qualityValue=parseFloat(qualityCell?.textContent??"1");const html=`<input\n            step="0.01"\n            type="number"\n            value="${qualityValue}"\n            onchange="document.getElementById('dressing[${index}]_ctrl').value=\n                    (this.value - products[${index}][5])/(products[${index}][6] - products[${index}][5]);\n                changeRow(${index});\n                return false;"\n        >`;const newInputEl=document.createElement("input");el.style.display="none";el.parentElement?.appendChild(newInputEl);newInputEl.outerHTML=html}))};exports.upgradeQualityInput=upgradeQualityInput},254:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:true});exports.upgradeVendorsTable=void 0;const formatNumber_1=__webpack_require__(897);const upgradeVendorsTable=async()=>{const dd=document.querySelector("#vendorstbl");if(!dd){return}addFooterInfo(dd);const Price=dd.querySelector("tbody >tr > td:last-child").cellIndex+1;const mark="price";const Ck=0;if(mark==="price"){const priceCells=dd.querySelectorAll("tbody > tr > td:nth-child("+Price+")");priceCells.forEach((function(cell,row){const b=document.createElement("b");cell.appendChild(b);const c=calcK(dd,cell,row);if(Ck){b.style.color=c<=Ck?"green":"red"}b.textContent=" "+(0,formatNumber_1.formatMoney)(c.toFixed(c>100?0:2))}))}};exports.upgradeVendorsTable=upgradeVendorsTable;const addFooterInfo=dd=>{const dd2=dd.querySelector("tfoot > tr > td:nth-child(4)");if(!dd2){return}if(dd2.textContent==="Среднее по городу:"){const dd3=dd.querySelector("tfoot > tr > td:nth-child(8)")?dd.querySelector("tfoot > tr > td:nth-child(8)"):dd.querySelector("tfoot > tr > td:nth-child(6)");if(dd3){const C1=parseFloat(dd3.textContent?.replace(/(p\.|\s)+/g,"")??"");const C2=parseFloat(dd.querySelector("tfoot > tr > td:nth-child(5)")?.textContent??"");const Ck=C1/C2;dd3.textContent+=" "+(0,formatNumber_1.formatMoney)(Ck.toFixed(Ck>100?0:2))}}};const calcK=(dd,i,row)=>{const cells=dd.querySelectorAll("tbody > tr > td:nth-child(9)");const cell=cells[row];const priceValue=parseFloat(i.textContent?.replace(/(p\.|\s)+/g,"")??"");return priceValue/parseFloat(cell?.textContent??"")}},478:(__unused_webpack_module,exports)=>{Object.defineProperty(exports,"__esModule",{value:true});exports.addFontAwesome=void 0;let fontAwesomeAdded=false;const addFontAwesome=async()=>{if(fontAwesomeAdded){return}fontAwesomeAdded=true;createStyleSheet("https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css");addCSStyle([{name:"fa-check",type:".",properties:[{color:"green"}]}])};exports.addFontAwesome=addFontAwesome;function createStyleSheet(href){let element;if(typeof href!=="undefined"){element=document.createElement("link");element.type="text/css";element.rel="stylesheet";element.href=href}else{element=document.createElement("style");element.type="text/css"}document.getElementsByTagName("head")[0].appendChild(element);let sheet=document.styleSheets[document.styleSheets.length-1];if(typeof sheet.addRule==="undefined"){sheet.addRule=(selectorText,cssText,index)=>{if(typeof index==="undefined"){index=sheet.cssRules.length}return sheet.insertRule(selectorText+" {"+cssText+"}",index)}}if(typeof sheet.removeRule==="undefined"){sheet.removeRule=sheet.deleteRule}return sheet}function addCSStyle(classes){const sheetN=createStyleSheet();classes.forEach((classItem=>{for(let propertyObj of classItem.properties){for(let property in propertyObj){sheetN.addRule(`${classItem.type}${classItem.name}`,`${property}: ${propertyObj[property]}`)}}}))}},680:(__unused_webpack_module,exports)=>{Object.defineProperty(exports,"__esModule",{value:true});exports.notEmpty=exports.notUndefined=void 0;const notUndefined=value=>value!==undefined;exports.notUndefined=notUndefined;const notEmpty=value=>Boolean(value);exports.notEmpty=notEmpty},897:(__unused_webpack_module,exports)=>{Object.defineProperty(exports,"__esModule",{value:true});exports.formatNumber=exports.formatMoney=void 0;const moneyFormat=new Intl.NumberFormat("ru-RU",{style:"currency",currency:"RUB",signDisplay:"auto",minimumFractionDigits:0,maximumFractionDigits:2});const formatMoney=val=>{const value=parseFloat(val);return isNaN(value)?val:moneyFormat.format(value).replace(" "," ").replace(",",".").replace("₽","р.")};exports.formatMoney=formatMoney;const formatNumber=val=>{const value=parseFloat(val);return isNaN(value)?val:value.toLocaleString("ru-RU").replace(",",".")};exports.formatNumber=formatNumber},822:(__unused_webpack_module,exports)=>{Object.defineProperty(exports,"__esModule",{value:true});exports.insertAfter=void 0;const insertAfter=function(node,referenceNode){if(!node||!referenceNode){return}const parent=referenceNode.parentNode;const nextSibling=referenceNode.nextSibling;if(nextSibling&&parent){parent.insertBefore(node,referenceNode.nextSibling)}else if(parent){parent.appendChild(node)}};exports.insertAfter=insertAfter},584:(__unused_webpack_module,exports)=>{Object.defineProperty(exports,"__esModule",{value:true});exports.getHtml=void 0;const getHtml=async url=>{const response=await fetch(url);if(!response.ok){return}const htmlString=await response.text();const frame=document.createElement("frame");frame.innerHTML=htmlString.trim();if(!frame.innerText){return}return frame};exports.getHtml=getHtml}};var __webpack_module_cache__={};function __webpack_require__(moduleId){var cachedModule=__webpack_module_cache__[moduleId];if(cachedModule!==undefined){return cachedModule.exports}var module=__webpack_module_cache__[moduleId]={exports:{}};__webpack_modules__[moduleId].call(module.exports,module,module.exports,__webpack_require__);return module.exports}var __webpack_exports__={};(()=>{var exports=__webpack_exports__;var __webpack_unused_export__;__webpack_unused_export__={value:true};const pages_1=__webpack_require__(826);const getMyCompany_1=__webpack_require__(591);const mainMenu_1=__webpack_require__(793);(async function(){const dlh=document.location.host;const dlp=document.location.pathname;const sp=new URLSearchParams(document.location.search);if(dlh!=="bizmania.ru"){return}if(dlp.startsWith("/user/messages")){return}const{companyId}=await(0,getMyCompany_1.getMyCompany)();if(!!companyId){(0,mainMenu_1.upgradeMainMenu)(companyId)}switch(true){case dlp.startsWith("/user/gameshop"):{switch(sp.get("tab")){case"weeklypacks":{(0,pages_1.onWeeklyPacksPage)();break}}break}case dlp.startsWith("/units/vendor/select"):{(0,pages_1.onVendorSelectPage)();break}case dlp.startsWith("/units/equipment/purchase"):{(0,pages_1.onEquipmentPurchasePage)();break}case dlp.startsWith("/units/factory"):{(0,pages_1.onFactoryPage)();break}case dlp.startsWith("/units/mine"):{(0,pages_1.onMinePage)();break}case dlp.startsWith("/units/sawmill"):{(0,pages_1.onSawmillPage)();break}case dlp.startsWith("/units/fishfarm"):{(0,pages_1.onFishfarmPage)();break}case dlp.startsWith("/units/shop"):{(0,pages_1.onShopPage)();break}case dlp.startsWith("/units/produce/calculator"):{(0,pages_1.onCalculatorPage)();break}case dlp.startsWith("/units/construction"):{(0,pages_1.onConstructionPage)();break}case dlp.startsWith("/units/warehouse"):{(0,pages_1.onWarehousePage)();break}}})().catch(console.error)})()})();